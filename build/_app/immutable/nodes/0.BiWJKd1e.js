import{s as te,Y as Ue,e as j,a as E,t as ge,c as N,b as G,g as L,d as he,f as w,l as z,i as S,h as A,p as we,j as _e,r as Re,n as H,y as Me,w as J,H as We,x as ye,q as He,v as ke,k as $e,K as Ke,R as Ce,T as Te,u as B,E as Ve,z as Xe,O as Ye,A as Ge,B as Je,C as Qe}from"../chunks/scheduler.BSglW4Eu.js";import{S as ne,i as se,c as v,a as k,m as y,t as d,g as re,b as h,d as oe,e as C}from"../chunks/index.B6nwG8t1.js";import{p as Ze}from"../chunks/stores.DHrwcOMg.js";import{A as ue,a as Q,b as R,a3 as xe,$ as et,h as le,j as ie,U as P,B as tt,a4 as nt,R as st,S as ve,C as rt,M as ot,a5 as me,l as x,f as Ee,a6 as at,G as W,c as lt}from"../chunks/Store.C7chqkCm.js";import{e as Le,T as pe,a as it}from"../chunks/UnderConstruction.svelte_svelte_type_style_lang.BTmHYDHa.js";import{V as M,g as ut,c as ft,h as ct}from"../chunks/Role.svelte_svelte_type_style_lang.DH52IsR2.js";/* empty css                                                       */import{w as De,g as mt}from"../chunks/entry.BMimn8ju.js";/* empty css                                                    */import{B as de,I as fe}from"../chunks/Icon.B1phACMf.js";import{L as je}from"../chunks/Label.CVPQHKIp.js";import{K as $t}from"../chunks/KeyboardListener.BgH-XNAY.js";import{S as Ne}from"../chunks/Spacer.Bj84Ivn3.js";import{C as Be}from"../chunks/Controls.B9s4QfWS.js";import{P as pt}from"../chunks/ProfilePictureMany.B4hCQL_8.js";import{P as Ie}from"../chunks/ProfilePicture.D5f3G5br.js";import{G as dt}from"../chunks/GamepadListener.C2wmtnDY.js";import{i as gt}from"../chunks/index.DVwmPmWW.js";import{M as ht}from"../chunks/Market.B0lYw9UP.js";const _t=!0,bt=!1,zn=Object.freeze(Object.defineProperty({__proto__:null,prerender:_t,ssr:bt},Symbol.toStringTag,{value:"Module"}));function Ae(r){let e,n,t;return n=new fe({props:{icon:r[0].icon,highlight:r[0].appearance}}),{c(){e=j("div"),v(n.$$.fragment),this.h()},l(s){e=N(s,"DIV",{class:!0});var a=G(e);k(n.$$.fragment,a),a.forEach(w),this.h()},h(){z(e,"class","toast-icon svelte-ph8lzn")},m(s,a){S(s,e,a),y(n,e,null),t=!0},p(s,a){const l={};a&1&&(l.icon=s[0].icon),a&1&&(l.highlight=s[0].appearance),n.$set(l)},i(s){t||(d(n.$$.fragment,s),t=!0)},o(s){h(n.$$.fragment,s),t=!1},d(s){s&&w(e),C(n)}}}function wt(r){let e,n;return e=new fe({props:{icon:Q.XMark}}),{c(){v(e.$$.fragment)},l(t){k(e.$$.fragment,t)},m(t,s){y(e,t,s),n=!0},p:H,i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function vt(r){let e,n,t,s,a,l,u=r[0].content+"",o,c,g,i,p,f,m=r[0].icon&&Ae(r);return s=new je({props:{text:r[0].title}}),g=new de({props:{small:!0,icon:!0,appearance:ue.Alt,$$slots:{default:[wt]},$$scope:{ctx:r}}}),g.$on("click",function(){Ue(r[1])&&r[1].apply(this,arguments)}),{c(){e=j("div"),m&&m.c(),n=E(),t=j("div"),v(s.$$.fragment),a=E(),l=j("p"),o=ge(u),c=E(),v(g.$$.fragment),this.h()},l($){e=N($,"DIV",{class:!0,role:!0});var b=G(e);m&&m.l(b),n=L(b),t=N(b,"DIV",{class:!0});var D=G(t);k(s.$$.fragment,D),a=L(D),l=N(D,"P",{class:!0});var F=G(l);o=he(F,u),F.forEach(w),D.forEach(w),c=L(b),k(g.$$.fragment,b),b.forEach(w),this.h()},h(){z(l,"class","svelte-ph8lzn"),z(t,"class","toast-content svelte-ph8lzn"),z(e,"class","toast svelte-ph8lzn"),z(e,"role","none")},m($,b){S($,e,b),m&&m.m(e,null),A(e,n),A(e,t),y(s,t,null),A(t,a),A(t,l),A(l,o),A(e,c),y(g,e,null),i=!0,p||(f=[we(e,"mouseleave",r[2]),we(e,"mouseenter",r[3]),we(e,"click",r[4])],p=!0)},p($,[b]){r=$,r[0].icon?m?(m.p(r,b),b&1&&d(m,1)):(m=Ae(r),m.c(),d(m,1),m.m(e,n)):m&&(re(),h(m,1,1,()=>{m=null}),oe());const D={};b&1&&(D.text=r[0].title),s.$set(D),(!i||b&1)&&u!==(u=r[0].content+"")&&_e(o,u);const F={};b&32&&(F.$$scope={dirty:b,ctx:r}),g.$set(F)},i($){i||(d(m),d(s.$$.fragment,$),d(g.$$.fragment,$),i=!0)},o($){h(m),h(s.$$.fragment,$),h(g.$$.fragment,$),i=!1},d($){$&&w(e),m&&m.d(),C(s),C(g),p=!1,Re(f)}}}function kt(r,e,n){let{toast:t}=e,{remove:s}=e;function a(o){Me.call(this,r,o)}function l(o){Me.call(this,r,o)}const u=o=>{t.onclick&&(t.onclick(),s())};return r.$$set=o=>{"toast"in o&&n(0,t=o.toast),"remove"in o&&n(1,s=o.remove)},[t,s,a,l,u]}class yt extends ne{constructor(e){super(),se(this,e,kt,vt,te,{toast:0,remove:1})}}function Fe(r,e,n){const t=r.slice();return t[5]=e[n][0],t[6]=e[n][1][0],t[7]=e[n][1][1],t}function Pe(r){let e,n;function t(){return r[2](r[5])}function s(...l){return r[3](r[5],...l)}function a(...l){return r[4](r[5],...l)}return e=new yt({props:{toast:r[6],remove:t}}),e.$on("mouseenter",s),e.$on("mouseleave",a),{c(){v(e.$$.fragment)},l(l){k(e.$$.fragment,l)},m(l,u){y(e,l,u),n=!0},p(l,u){r=l;const o={};u&2&&(o.toast=r[6]),u&2&&(o.remove=t),e.$set(o)},i(l){n||(d(e.$$.fragment,l),n=!0)},o(l){h(e.$$.fragment,l),n=!1},d(l){C(e,l)}}}function Ct(r){let e,n,t=Le(Object.entries(r[1])),s=[];for(let l=0;l<t.length;l+=1)s[l]=Pe(Fe(r,t,l));const a=l=>h(s[l],1,1,()=>{s[l]=null});return{c(){for(let l=0;l<s.length;l+=1)s[l].c();e=J()},l(l){for(let u=0;u<s.length;u+=1)s[u].l(l);e=J()},m(l,u){for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(l,u);S(l,e,u),n=!0},p(l,[u]){if(u&2){t=Le(Object.entries(l[1]));let o;for(o=0;o<t.length;o+=1){const c=Fe(l,t,o);s[o]?(s[o].p(c,u),d(s[o],1)):(s[o]=Pe(c),s[o].c(),d(s[o],1),s[o].m(e.parentNode,e))}for(re(),o=t.length;o<s.length;o+=1)a(o);oe()}},i(l){if(!n){for(let u=0;u<t.length;u+=1)d(s[u]);n=!0}},o(l){s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)h(s[u]);n=!1},d(l){l&&w(e),We(s,l)}}}function Tt(r,e,n){let t,s,a=H,l=()=>(a(),a=ye(t,g=>n(1,s=g)),t);r.$$.on_destroy.push(()=>a());const u=g=>R.removeToast(g),o=(g,i)=>R.pauseToastTimeout(g),c=(g,i)=>R.resumeToastTimeout(g);return l(n(0,t=R.state.toasts)),[t,s,u,o,c]}class It extends ne{constructor(e){super(),se(this,e,Tt,Ct,te,{})}}function St(r){const e=He();function n(t){const s=xe[t.button];s!==void 0&&e("clicked",s)}return ke(()=>(window.addEventListener("mousedown",n),()=>{window.removeEventListener("mousedown",n)})),[]}class Mt extends ne{constructor(e){super(),se(this,e,St,null,te,{})}}function qe(r){let e,n,t,s,a,l,u;const o=[Lt,Et],c=[];function g(i,p){return i[3]?0:1}return s=g(r),a=c[s]=o[s](r),{c(){e=j("div"),n=j("div"),t=j("div"),a.c(),this.h()},l(i){e=N(i,"DIV",{id:!0,class:!0});var p=G(e);n=N(p,"DIV",{class:!0});var f=G(n);t=N(f,"DIV",{class:!0,style:!0});var m=G(t);a.l(m),m.forEach(w),f.forEach(w),p.forEach(w),this.h()},h(){z(t,"class","content svelte-fnt4oa"),z(t,"style",l=r[3]?"border: var(--border-width) solid var(--warning-color);":"border: var(--border-width) solid var(--success-color);"),z(n,"class","body svelte-fnt4oa"),z(e,"id","incoming-call"),z(e,"class","svelte-fnt4oa")},m(i,p){S(i,e,p),A(e,n),A(n,t),c[s].m(t,null),u=!0},p(i,p){let f=s;s=g(i),s===f?c[s].p(i,p):(re(),h(c[f],1,1,()=>{c[f]=null}),oe(),a=c[s],a?a.p(i,p):(a=c[s]=o[s](i),a.c()),d(a,1),a.m(t,null)),(!u||p&8&&l!==(l=i[3]?"border: var(--border-width) solid var(--warning-color);":"border: var(--border-width) solid var(--success-color);"))&&z(t,"style",l)},i(i){u||(d(a),u=!0)},o(i){h(a),u=!1},d(i){i&&w(e),c[s].d()}}}function Et(r){let e,n,t,s,a,l,u,o,c;const g=[At,Dt],i=[];function p(f,m){return f[0].kind===rt.DirectMessage?0:1}return e=p(r),n=i[e]=g[e](r),s=new Ne({props:{less:!0}}),l=new Be({props:{$$slots:{default:[Rt]},$$scope:{ctx:r}}}),o=new de({props:{appearance:ue.Error,text:r[7]("settings.calling.decline"),$$slots:{default:[Vt]},$$scope:{ctx:r}}}),o.$on("click",r[11]),{c(){n.c(),t=E(),v(s.$$.fragment),a=E(),v(l.$$.fragment),u=E(),v(o.$$.fragment)},l(f){n.l(f),t=L(f),k(s.$$.fragment,f),a=L(f),k(l.$$.fragment,f),u=L(f),k(o.$$.fragment,f)},m(f,m){i[e].m(f,m),S(f,t,m),y(s,f,m),S(f,a,m),y(l,f,m),S(f,u,m),y(o,f,m),c=!0},p(f,m){let $=e;e=p(f),e===$?i[e].p(f,m):(re(),h(i[$],1,1,()=>{i[$]=null}),oe(),n=i[e],n?n.p(f,m):(n=i[e]=g[e](f),n.c()),d(n,1),n.m(t.parentNode,t));const b={};m&131200&&(b.$$scope={dirty:m,ctx:f}),l.$set(b);const D={};m&128&&(D.text=f[7]("settings.calling.decline")),m&131072&&(D.$$scope={dirty:m,ctx:f}),o.$set(D)},i(f){c||(d(n),d(s.$$.fragment,f),d(l.$$.fragment,f),d(o.$$.fragment,f),c=!0)},o(f){h(n),h(s.$$.fragment,f),h(l.$$.fragment,f),h(o.$$.fragment,f),c=!1},d(f){f&&(w(t),w(a),w(u)),i[e].d(f),C(s,f),C(l,f),C(o,f)}}}function Lt(r){let e,n,t,s,a,l,u,o,c,g;return e=new Ie({props:{id:r[6].key,size:ve.Large,image:r[6].profile.photo.image,status:r[6].profile.status}}),t=new pe({props:{$$slots:{default:[jt]},$$scope:{ctx:r}}}),a=new pe({props:{muted:!0,size:ve.Large,$$slots:{default:[Nt]},$$scope:{ctx:r}}}),u=new pe({props:{muted:!0,size:ve.Large,$$slots:{default:[Bt]},$$scope:{ctx:r}}}),c=new Ne({props:{less:!0}}),{c(){v(e.$$.fragment),n=E(),v(t.$$.fragment),s=E(),v(a.$$.fragment),l=E(),v(u.$$.fragment),o=E(),v(c.$$.fragment)},l(i){k(e.$$.fragment,i),n=L(i),k(t.$$.fragment,i),s=L(i),k(a.$$.fragment,i),l=L(i),k(u.$$.fragment,i),o=L(i),k(c.$$.fragment,i)},m(i,p){y(e,i,p),S(i,n,p),y(t,i,p),S(i,s,p),y(a,i,p),S(i,l,p),y(u,i,p),S(i,o,p),y(c,i,p),g=!0},p(i,p){const f={};p&64&&(f.id=i[6].key),p&64&&(f.image=i[6].profile.photo.image),p&64&&(f.status=i[6].profile.status),e.$set(f);const m={};p&131136&&(m.$$scope={dirty:p,ctx:i}),t.$set(m);const $={};p&131200&&($.$$scope={dirty:p,ctx:i}),a.$set($);const b={};p&131200&&(b.$$scope={dirty:p,ctx:i}),u.$set(b)},i(i){g||(d(e.$$.fragment,i),d(t.$$.fragment,i),d(a.$$.fragment,i),d(u.$$.fragment,i),d(c.$$.fragment,i),g=!0)},o(i){h(e.$$.fragment,i),h(t.$$.fragment,i),h(a.$$.fragment,i),h(u.$$.fragment,i),h(c.$$.fragment,i),g=!1},d(i){i&&(w(n),w(s),w(l),w(o)),C(e,i),C(t,i),C(a,i),C(u,i),C(c,i)}}}function Dt(r){let e,n,t,s,a,l,u;return e=new Ie({props:{id:r[6].key,size:ve.Medium,image:r[6].profile.photo.image,status:r[6].profile.status}}),s=new pe({props:{$$slots:{default:[Ft]},$$scope:{ctx:r}}}),l=new pt({props:{users:r[8]}}),{c(){v(e.$$.fragment),n=E(),t=j("div"),v(s.$$.fragment),a=E(),v(l.$$.fragment),this.h()},l(o){k(e.$$.fragment,o),n=L(o),t=N(o,"DIV",{class:!0});var c=G(t);k(s.$$.fragment,c),c.forEach(w),a=L(o),k(l.$$.fragment,o),this.h()},h(){z(t,"class","text-container svelte-fnt4oa")},m(o,c){y(e,o,c),S(o,n,c),S(o,t,c),y(s,t,null),S(o,a,c),y(l,o,c),u=!0},p(o,c){const g={};c&64&&(g.id=o[6].key),c&64&&(g.image=o[6].profile.photo.image),c&64&&(g.status=o[6].profile.status),e.$set(g);const i={};c&131265&&(i.$$scope={dirty:c,ctx:o}),s.$set(i);const p={};c&256&&(p.users=o[8]),l.$set(p)},i(o){u||(d(e.$$.fragment,o),d(s.$$.fragment,o),d(l.$$.fragment,o),u=!0)},o(o){h(e.$$.fragment,o),h(s.$$.fragment,o),h(l.$$.fragment,o),u=!1},d(o){o&&(w(n),w(t),w(a)),C(e,o),C(s),C(l,o)}}}function At(r){let e,n,t,s,a,l;e=new Ie({props:{id:r[6].key,size:ve.Large,image:r[6].profile.photo.image,status:r[6].profile.status}}),t=new pe({props:{$$slots:{default:[Pt]},$$scope:{ctx:r}}});let u=r[6].profile.status_message!==""&&ze(r);return{c(){v(e.$$.fragment),n=E(),v(t.$$.fragment),s=E(),u&&u.c(),a=J()},l(o){k(e.$$.fragment,o),n=L(o),k(t.$$.fragment,o),s=L(o),u&&u.l(o),a=J()},m(o,c){y(e,o,c),S(o,n,c),y(t,o,c),S(o,s,c),u&&u.m(o,c),S(o,a,c),l=!0},p(o,c){const g={};c&64&&(g.id=o[6].key),c&64&&(g.image=o[6].profile.photo.image),c&64&&(g.status=o[6].profile.status),e.$set(g);const i={};c&131136&&(i.$$scope={dirty:c,ctx:o}),t.$set(i),o[6].profile.status_message!==""?u?(u.p(o,c),c&64&&d(u,1)):(u=ze(o),u.c(),d(u,1),u.m(a.parentNode,a)):u&&(re(),h(u,1,1,()=>{u=null}),oe())},i(o){l||(d(e.$$.fragment,o),d(t.$$.fragment,o),d(u),l=!0)},o(o){h(e.$$.fragment,o),h(t.$$.fragment,o),h(u),l=!1},d(o){o&&(w(n),w(s),w(a)),C(e,o),C(t,o),u&&u.d(o)}}}function Ft(r){let e,n=r[7]("settings.calling.userInviteToAGroupCall",{values:{user:`<span class="bold-text" style="font-weight: bold">${r[6].name}</span>`,group:`<span class="bold-text" style="font-weight: bold">${r[0].name}</span>`}})+"",t;return{c(){e=new Ce(!1),t=J(),this.h()},l(s){e=Te(s,!1),t=J(),this.h()},h(){e.a=t},m(s,a){e.m(n,s,a),S(s,t,a)},p(s,a){a&193&&n!==(n=s[7]("settings.calling.userInviteToAGroupCall",{values:{user:`<span class="bold-text" style="font-weight: bold">${s[6].name}</span>`,group:`<span class="bold-text" style="font-weight: bold">${s[0].name}</span>`}})+"")&&e.p(n)},d(s){s&&(w(t),e.d())}}}function Pt(r){let e=r[6].name+"",n;return{c(){n=ge(e)},l(t){n=he(t,e)},m(t,s){S(t,n,s)},p(t,s){s&64&&e!==(e=t[6].name+"")&&_e(n,e)},d(t){t&&w(n)}}}function ze(r){let e,n;return e=new pe({props:{muted:!0,$$slots:{default:[qt]},$$scope:{ctx:r}}}),{c(){v(e.$$.fragment)},l(t){k(e.$$.fragment,t)},m(t,s){y(e,t,s),n=!0},p(t,s){const a={};s&131136&&(a.$$scope={dirty:s,ctx:t}),e.$set(a)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function qt(r){let e=r[6].profile.status_message+"",n;return{c(){n=ge(e)},l(t){n=he(t,e)},m(t,s){S(t,n,s)},p(t,s){s&64&&e!==(e=t[6].profile.status_message+"")&&_e(n,e)},d(t){t&&w(n)}}}function zt(r){let e,n;return e=new fe({props:{icon:Q.PhoneCall}}),{c(){v(e.$$.fragment)},l(t){k(e.$$.fragment,t)},m(t,s){y(e,t,s),n=!0},p:H,i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function Ot(r){let e,n;return e=new fe({props:{icon:Q.VideoCamera}}),{c(){v(e.$$.fragment)},l(t){k(e.$$.fragment,t)},m(t,s){y(e,t,s),n=!0},p:H,i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function Rt(r){let e,n,t,s;return e=new de({props:{appearance:ue.Success,text:r[7]("settings.calling.voice"),$$slots:{default:[zt]},$$scope:{ctx:r}}}),e.$on("click",r[12]),t=new de({props:{appearance:ue.Success,text:r[7]("settings.calling.video"),$$slots:{default:[Ot]},$$scope:{ctx:r}}}),t.$on("click",r[13]),{c(){v(e.$$.fragment),n=E(),v(t.$$.fragment)},l(a){k(e.$$.fragment,a),n=L(a),k(t.$$.fragment,a)},m(a,l){y(e,a,l),S(a,n,l),y(t,a,l),s=!0},p(a,l){const u={};l&128&&(u.text=a[7]("settings.calling.voice")),l&131072&&(u.$$scope={dirty:l,ctx:a}),e.$set(u);const o={};l&128&&(o.text=a[7]("settings.calling.video")),l&131072&&(o.$$scope={dirty:l,ctx:a}),t.$set(o)},i(a){s||(d(e.$$.fragment,a),d(t.$$.fragment,a),s=!0)},o(a){h(e.$$.fragment,a),h(t.$$.fragment,a),s=!1},d(a){a&&w(n),C(e,a),C(t,a)}}}function Vt(r){let e,n;return e=new fe({props:{icon:Q.PhoneXMark}}),{c(){v(e.$$.fragment)},l(t){k(e.$$.fragment,t)},m(t,s){y(e,t,s),n=!0},p:H,i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function jt(r){let e=r[6].name+"",n;return{c(){n=ge(e)},l(t){n=he(t,e)},m(t,s){S(t,n,s)},p(t,s){s&64&&e!==(e=t[6].name+"")&&_e(n,e)},d(t){t&&w(n)}}}function Nt(r){let e=r[7]("settings.calling.hasCancelled")+"",n;return{c(){n=ge(e)},l(t){n=he(t,e)},m(t,s){S(t,n,s)},p(t,s){s&128&&e!==(e=t[7]("settings.calling.hasCancelled")+"")&&_e(n,e)},d(t){t&&w(n)}}}function Bt(r){let e=r[7]("settings.calling.disconnecting")+"",n;return{c(){n=ge(e)},l(t){n=he(t,e)},m(t,s){S(t,n,s)},p(t,s){s&128&&e!==(e=t[7]("settings.calling.disconnecting")+"")&&_e(n,e)},d(t){t&&w(n)}}}function Ut(r){var s;let e,n,t=r[1]&&(M.incomingCallFrom===null||M.incomingCallFrom&&r[5]!==((s=M.incomingCallFrom[1])==null?void 0:s.metadata.channel))&&qe(r);return{c(){t&&t.c(),e=J()},l(a){t&&t.l(a),e=J()},m(a,l){t&&t.m(a,l),S(a,e,l),n=!0},p(a,[l]){var u;a[1]&&(M.incomingCallFrom===null||M.incomingCallFrom&&a[5]!==((u=M.incomingCallFrom[1])==null?void 0:u.metadata.channel))?t?(t.p(a,l),l&34&&d(t,1)):(t=qe(a),t.c(),d(t,1),t.m(e.parentNode,e)):t&&(re(),h(t,1,1,()=>{t=null}),oe())},i(a){n||(d(t),n=!0)},o(a){h(t),n=!1},d(a){a&&w(e),t&&t.d(a)}}}function Wt(r,e,n){let t,s,a,l,u,o,c=H,g=()=>(c(),c=ye(D,q=>n(6,o=q)),D),i,p,f=H,m=()=>(f(),f=ye(s,q=>n(8,p=q)),s);$e(r,ut,q=>n(16,a=q)),$e(r,ft,q=>n(5,u=q)),$e(r,et,q=>n(7,i=q)),r.$$.on_destroy.push(()=>c()),r.$$.on_destroy.push(()=>f());let $,b=!1,D=De(tt);g();let F;ke(()=>{n(3,t=!1),clearTimeout(F)}),Ke(()=>{n(3,t=!1),clearTimeout(F)});const O=De(nt);$e(r,O,q=>n(0,l=q)),R.state.pendingCall.subscribe(async q=>{if(M.incomingCallFrom&&!M.toCall&&a){$==null&&($=await le(ie.IncomingCall,{loop:!0})),n(1,b=!0);let _=P.getChat(M.incomingCallFrom[1].metadata.channel);_&&(O.set(_),m(n(4,s=R.getUsers(l.users)))),g(n(2,D=R.getUser(M.incomingCallFrom[1].metadata.did)))}else a?(n(1,b=!1),$==null||$.stop(),$=void 0):(n(3,t=!0),$==null||$.stop(),$=void 0,F=setTimeout(()=>{n(3,t=!1),n(1,b=!1)},4e3))});async function Z(q=!0){mt(st.Chat),await M.acceptCall(q),R.setActiveChat(R.getCallingChat(M.channel)),n(1,b=!1),$==null||$.stop(),$=void 0}function K(){n(1,b=!1),$==null||$.stop(),$=void 0,M.leaveCall(!1)}const ae=q=>Z(!0),X=q=>Z(!1);return r.$$.update=()=>{r.$$.dirty&1&&m(n(4,s=R.getUsers(l.users)))},n(3,t=!1),[l,b,D,t,s,u,o,i,p,O,Z,K,ae,X]}class Ht extends ne{constructor(e){super(),se(this,e,Wt,Ut,te,{})}}function Kt(r,e,n){let{rate:t=5e3}=e,s=100,a=B(R.state.activeChat);async function l(){u(),await ot.fetchAllFriendsAndRequests(!B(ct)),s<t&&(s=Math.min(s*2,t)),setTimeout(l,s)}async function u(){P.updateTypingIndicators(a)}return ke(()=>{l()}),r.$$set=o=>{"rate"in o&&n(0,t=o.rate)},[t]}class Xt extends ne{constructor(e){super(),se(this,e,Kt,null,te,{rate:0})}}const Yt={locale:"en",long:{year:{previous:"last year",current:"this year",next:"next year",past:{one:"{0} year ago",other:"{0} years ago"},future:{one:"in {0} year",other:"in {0} years"}},quarter:{previous:"last quarter",current:"this quarter",next:"next quarter",past:{one:"{0} quarter ago",other:"{0} quarters ago"},future:{one:"in {0} quarter",other:"in {0} quarters"}},month:{previous:"last month",current:"this month",next:"next month",past:{one:"{0} month ago",other:"{0} months ago"},future:{one:"in {0} month",other:"in {0} months"}},week:{previous:"last week",current:"this week",next:"next week",past:{one:"{0} week ago",other:"{0} weeks ago"},future:{one:"in {0} week",other:"in {0} weeks"}},day:{previous:"yesterday",current:"today",next:"tomorrow",past:{one:"{0} day ago",other:"{0} days ago"},future:{one:"in {0} day",other:"in {0} days"}},hour:{current:"this hour",past:{one:"{0} hour ago",other:"{0} hours ago"},future:{one:"in {0} hour",other:"in {0} hours"}},minute:{current:"this minute",past:{one:"{0} minute ago",other:"{0} minutes ago"},future:{one:"in {0} minute",other:"in {0} minutes"}},second:{current:"now",past:{one:"{0} second ago",other:"{0} seconds ago"},future:{one:"in {0} second",other:"in {0} seconds"}}},short:{year:{previous:"last yr.",current:"this yr.",next:"next yr.",past:"{0} yr. ago",future:"in {0} yr."},quarter:{previous:"last qtr.",current:"this qtr.",next:"next qtr.",past:{one:"{0} qtr. ago",other:"{0} qtrs. ago"},future:{one:"in {0} qtr.",other:"in {0} qtrs."}},month:{previous:"last mo.",current:"this mo.",next:"next mo.",past:"{0} mo. ago",future:"in {0} mo."},week:{previous:"last wk.",current:"this wk.",next:"next wk.",past:"{0} wk. ago",future:"in {0} wk."},day:{previous:"yesterday",current:"today",next:"tomorrow",past:{one:"{0} day ago",other:"{0} days ago"},future:{one:"in {0} day",other:"in {0} days"}},hour:{current:"this hour",past:"{0} hr. ago",future:"in {0} hr."},minute:{current:"this minute",past:"{0} min. ago",future:"in {0} min."},second:{current:"now",past:"{0} sec. ago",future:"in {0} sec."}},narrow:{year:{previous:"last yr.",current:"this yr.",next:"next yr.",past:"{0}y ago",future:"in {0}y"},quarter:{previous:"last qtr.",current:"this qtr.",next:"next qtr.",past:"{0}q ago",future:"in {0}q"},month:{previous:"last mo.",current:"this mo.",next:"next mo.",past:"{0}mo ago",future:"in {0}mo"},week:{previous:"last wk.",current:"this wk.",next:"next wk.",past:"{0}w ago",future:"in {0}w"},day:{previous:"yesterday",current:"today",next:"tomorrow",past:"{0}d ago",future:"in {0}d"},hour:{current:"this hour",past:"{0}h ago",future:"in {0}h"},minute:{current:"this minute",past:"{0}m ago",future:"in {0}m"},second:{current:"now",past:"{0}s ago",future:"in {0}s"}},now:{now:{current:"now",future:"in a moment",past:"just now"}},mini:{year:"{0}yr",month:"{0}mo",week:"{0}wk",day:"{0}d",hour:"{0}h",minute:"{0}m",second:"{0}s",now:"now"},"short-time":{year:"{0} yr.",month:"{0} mo.",week:"{0} wk.",day:{one:"{0} day",other:"{0} days"},hour:"{0} hr.",minute:"{0} min.",second:"{0} sec."},"long-time":{year:{one:"{0} year",other:"{0} years"},month:{one:"{0} month",other:"{0} months"},week:{one:"{0} week",other:"{0} weeks"},day:{one:"{0} day",other:"{0} days"},hour:{one:"{0} hour",other:"{0} hours"},minute:{one:"{0} minute",other:"{0} minutes"},second:{one:"{0} second",other:"{0} seconds"}}};function Gt(r){let e,n='<div class="spinner svelte-7gdiz0"></div>';return{c(){e=j("div"),e.innerHTML=n,this.h()},l(t){e=N(t,"DIV",{class:!0,"data-svelte-h":!0}),Ve(e)!=="svelte-1l1yhfb"&&(e.innerHTML=n),this.h()},h(){z(e,"class","spinner-container svelte-7gdiz0")},m(t,s){S(t,e,s)},p:H,i:H,o:H,d(t){t&&w(e)}}}class Jt extends ne{constructor(e){super(),se(this,e,null,Gt,te,{})}}function Oe(r){let e,n,t,s,a,l,u,o,c="Install our app for a better experience",g,i,p;return t=new de({props:{appearance:ue.Alt,icon:!0,$$slots:{default:[Qt]},$$scope:{ctx:r}}}),t.$on("click",r[2]),l=new je({props:{text:"Install Uplink"}}),i=new Be({props:{$$slots:{default:[xt]},$$scope:{ctx:r}}}),{c(){e=j("div"),n=j("div"),v(t.$$.fragment),s=E(),a=j("div"),v(l.$$.fragment),u=E(),o=j("p"),o.textContent=c,g=E(),v(i.$$.fragment),this.h()},l(f){e=N(f,"DIV",{id:!0,class:!0});var m=G(e);n=N(m,"DIV",{class:!0});var $=G(n);k(t.$$.fragment,$),s=L($),a=N($,"DIV",{class:!0});var b=G(a);k(l.$$.fragment,b),u=L(b),o=N(b,"P",{"data-svelte-h":!0}),Ve(o)!=="svelte-1f31mgs"&&(o.textContent=c),b.forEach(w),$.forEach(w),g=L(m),k(i.$$.fragment,m),m.forEach(w),this.h()},h(){z(a,"class","content"),z(n,"class","pre svelte-fxpy5g"),z(e,"id","install-banner"),z(e,"class","pulse-success svelte-fxpy5g")},m(f,m){S(f,e,m),A(e,n),y(t,n,null),A(n,s),A(n,a),y(l,a,null),A(a,u),A(a,o),A(e,g),y(i,e,null),p=!0},p(f,m){const $={};m&64&&($.$$scope={dirty:m,ctx:f}),t.$set($);const b={};m&64&&(b.$$scope={dirty:m,ctx:f}),i.$set(b)},i(f){p||(d(t.$$.fragment,f),d(l.$$.fragment,f),d(i.$$.fragment,f),p=!0)},o(f){h(t.$$.fragment,f),h(l.$$.fragment,f),h(i.$$.fragment,f),p=!1},d(f){f&&w(e),C(t),C(l),C(i)}}}function Qt(r){let e,n;return e=new fe({props:{icon:Q.XMark}}),{c(){v(e.$$.fragment)},l(t){k(e.$$.fragment,t)},m(t,s){y(e,t,s),n=!0},p:H,i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function Zt(r){let e,n;return e=new fe({props:{icon:r[3][r[1]].icon,highlight:ue.Success}}),{c(){v(e.$$.fragment)},l(t){k(e.$$.fragment,t)},m(t,s){y(e,t,s),n=!0},p:H,i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function xt(r){let e,n;return e=new de({props:{appearance:ue.Success,outline:!0,text:r[3][r[1]].text,$$slots:{default:[Zt]},$$scope:{ctx:r}}}),e.$on("click",r[4]),{c(){v(e.$$.fragment)},l(t){k(e.$$.fragment,t)},m(t,s){y(e,t,s),n=!0},p(t,s){const a={};s&64&&(a.$$scope={dirty:s,ctx:t}),e.$set(a)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function en(r){let e,n,t=r[0]&&Oe(r);return{c(){t&&t.c(),e=J()},l(s){t&&t.l(s),e=J()},m(s,a){t&&t.m(s,a),S(s,e,a),n=!0},p(s,[a]){s[0]?t?(t.p(s,a),a&1&&d(t,1)):(t=Oe(s),t.c(),d(t,1),t.m(e.parentNode,e)):t&&(re(),h(t,1,1,()=>{t=null}),oe())},i(s){n||(d(t),n=!0)},o(s){h(t),n=!1},d(s){s&&w(e),t&&t.d(s)}}}function tn(){const r=navigator.userAgent.toLowerCase();return r.includes("windows")?"Windows":r.includes("mac")?"MacOS":r.includes("android")?"Android":/iphone|ipad|ipod/.test(r)?"iOS":r.includes("linux")?"Linux":"Other"}function nn(){var r,e;return typeof window<"u"&&((e=(r=window.process)==null?void 0:r.versions)==null?void 0:e.electron)!==void 0}function sn(){return typeof window<"u"&&"__TAURI_INTERNALS__"in window}function rn(){return typeof window<"u"&&"Capacitor"in window}function on(){return localStorage.getItem("install-banner-dismissed")==="true"}function an(r,e,n){let t=!(nn()||sn()||rn()||on()),s=tn();function a(){n(0,t=!1),localStorage.setItem("install-banner-dismissed","true")}const l={Windows:{text:"Windows",icon:Q.MicrosoftWindows,download:me.Windows},MacOS:{text:"MacOS",icon:Q.AppleAppStore,download:me.Mac},Android:{text:"Android",icon:Q.Android,download:me.Android},iOS:{text:"iPhone",icon:Q.Apple,download:me.iOS},Linux:{text:"Linux",icon:Q.Code,download:me.Linux},Other:{text:"Download",icon:Q.Download,download:me.Linux}};return[t,s,a,l,()=>{window.open(l[s].download)}]}class ln extends ne{constructor(e){super(),se(this,e,an,en,te,{})}}function un(r){let e=0,n=0,t=0,s=0,a=0;const l=50,u=100,o=500;function c(i){const p=i.changedTouches[0];e=p.clientX,n=p.clientY,a=new Date().getTime()}function g(i){const p=i.changedTouches[0];t=p.clientX,s=p.clientY;const f=t-e,m=s-n;if(new Date().getTime()-a<=o){if(Math.abs(f)>=l&&Math.abs(m)<=u){const b=f>0?"swiperight":"swipeleft";r.dispatchEvent(new CustomEvent(b,{bubbles:!0}))}else if(Math.abs(m)>=l&&Math.abs(f)<=u){const b=m>0?"swipedown":"swipeup";r.dispatchEvent(new CustomEvent(b,{bubbles:!0}))}}}return r.addEventListener("touchstart",c,{passive:!0}),r.addEventListener("touchend",g,{passive:!0}),{destroy(){r.removeEventListener("touchstart",c),r.removeEventListener("touchend",g)}}}function fn(r){let e,n;return e=new Jt({}),{c(){v(e.$$.fragment)},l(t){k(e.$$.fragment,t)},m(t,s){y(e,t,s),n=!0},p:H,i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function cn(r){let e,n,t=`<style>${r[3]}</style>`,s,a,l,u,o,c=`<style>${r[2]}</style>`,g,i,p,f,m,$,b,D,F,O,Z,K,ae,X,q,_,U,Y,be,ce;i=new Xt({props:{rate:5e3}}),f=new $t({props:{keybinds:r[0]}}),f.$on("match",r[5]),f.$on("matchRelease",r[6]),$=new Mt({}),$.$on("clicked",dn),D=new It({}),O=new Ht({}),K=new dt({}),X=new ht({}),X.$on("close",r[10]),_=new ln({});const ee=r[9].default,V=Xe(ee,r,r[8],null);return{c(){e=j("div"),n=new Ce(!1),s=E(),a=j("link"),u=E(),o=new Ce(!1),g=E(),v(i.$$.fragment),p=E(),v(f.$$.fragment),m=E(),v($.$$.fragment),b=E(),v(D.$$.fragment),F=E(),v(O.$$.fragment),Z=E(),v(K.$$.fragment),ae=E(),v(X.$$.fragment),q=E(),v(_.$$.fragment),U=E(),V&&V.c(),this.h()},l(T){e=N(T,"DIV",{id:!0,class:!0});var I=G(e);n=Te(I,!1),s=L(I),a=N(I,"LINK",{rel:!0,href:!0}),u=L(I),o=Te(I,!1),g=L(I),k(i.$$.fragment,I),p=L(I),k(f.$$.fragment,I),m=L(I),k($.$$.fragment,I),b=L(I),k(D.$$.fragment,I),F=L(I),k(O.$$.fragment,I),Z=L(I),k(K.$$.fragment,I),ae=L(I),k(X.$$.fragment,I),q=L(I),k(_.$$.fragment,I),U=L(I),V&&V.l(I),I.forEach(w),this.h()},h(){n.a=s,z(a,"rel","stylesheet"),z(a,"href",l=`/assets/themes/${r[1]}.css`),o.a=g,z(e,"id","app"),z(e,"class","svelte-1m80qk0")},m(T,I){S(T,e,I),n.m(t,e),A(e,s),A(e,a),A(e,u),o.m(c,e),A(e,g),y(i,e,null),A(e,p),y(f,e,null),A(e,m),y($,e,null),A(e,b),y(D,e,null),A(e,F),y(O,e,null),A(e,Z),y(K,e,null),A(e,ae),y(X,e,null),A(e,q),y(_,e,null),A(e,U),V&&V.m(e,null),Y=!0,be||(ce=[Ye(un.call(null,e)),we(e,"swipeleft",r[11]),we(e,"swiperight",r[12])],be=!0)},p(T,I){(!Y||I&8)&&t!==(t=`<style>${T[3]}</style>`)&&n.p(t),(!Y||I&2&&l!==(l=`/assets/themes/${T[1]}.css`))&&z(a,"href",l),(!Y||I&4)&&c!==(c=`<style>${T[2]}</style>`)&&o.p(c);const Se={};I&1&&(Se.keybinds=T[0]),f.$set(Se),V&&V.p&&(!Y||I&256)&&Ge(V,ee,T,T[8],Y?Qe(ee,T[8],I,null):Je(T[8]),null)},i(T){Y||(d(i.$$.fragment,T),d(f.$$.fragment,T),d($.$$.fragment,T),d(D.$$.fragment,T),d(O.$$.fragment,T),d(K.$$.fragment,T),d(X.$$.fragment,T),d(_.$$.fragment,T),d(V,T),Y=!0)},o(T){h(i.$$.fragment,T),h(f.$$.fragment,T),h($.$$.fragment,T),h(D.$$.fragment,T),h(O.$$.fragment,T),h(K.$$.fragment,T),h(X.$$.fragment,T),h(_.$$.fragment,T),h(V,T),Y=!1},d(T){T&&w(e),C(i),C(f),C($),C(D),C(O),C(K),C(X),C(_),V&&V.d(T),be=!1,Re(ce)}}}function mn(r){let e,n,t,s;const a=[cn,fn],l=[];function u(o,c){return o[4]?0:1}return e=u(r),n=l[e]=a[e](r),{c(){n.c(),t=J()},l(o){n.l(o),t=J()},m(o,c){l[e].m(o,c),S(o,t,c),s=!0},p(o,[c]){let g=e;e=u(o),e===g?l[e].p(o,c):(re(),h(l[g],1,1,()=>{l[g]=null}),oe(),n=l[e],n?n.p(o,c):(n=l[e]=a[e](o),n.c()),d(n,1),n.m(t.parentNode,t))},i(o){s||(d(n),s=!0)},o(o){h(n),s=!1},d(o){o&&w(t),l[e].d(o)}}}function $n(r){return["ttf","otf","woff2","woff"].map(n=>`/assets/font/${r}.${n} format('${n}')`).join(", ")}function pn(r){const e=document.createElement("style");e.innerHTML=r,document.head.appendChild(e)}const dn=()=>{};function gn(r,e,n){let t,s;$e(r,Ze,_=>n(21,t=_)),$e(r,at,_=>n(7,s=_));let{$$slots:a={},$$scope:l}=e;x.debug("Initializing app, layout routes page."),it.addDefaultLocale(Yt);let u;B(Ee.state).devmode;let o=B(P.state.color),c=B(P.state.fontSize),g=B(P.state.font);B(P.state.allFonts);let i=B(P.state.emojiFont),p=B(P.state.theme),f=B(P.state.cssOverride),m=B(R.state.devices.muted),$=B(R.state.devices.deafened);function b(_){let U=_.detail;switch(U.state,U.action){case W.IncreaseFontSize:P.increaseFontSize();break;case W.DecreaseFontSize:P.decreaseFontSize();break;case W.ToggleMute:M.isInCall&&(R.updateMuted(!m),M.toggleMute(!m));break;case W.ToggleDeafen:M.isInCall&&(R.updateDeafened(!$),M.toggleDeafen(!$));break;case W.OpenInspector:x.info("todo");break;case W.ToggleDevmode:x.info("todo");break;case W.FocusUplink:x.info("todo");break;case W.PushToTalk:M.isInCall&&(le(ie.Press),M.toggleMute(!1));break;case W.PushToMute:M.isInCall&&(le(ie.Press),M.toggleMute(!0));break;case W.PushToDeafen:M.isInCall&&(le(ie.Press),M.toggleDeafen(!0));break;default:x.info("unhandled keybind "+U.action)}}function D(_){let U=_.detail;switch(U.state,U.action){case W.PushToTalk:M.isInCall&&(le(ie.Release),M.toggleMute(!0));break;case W.PushToMute:M.isInCall&&(le(ie.Release),M.toggleMute(!1));break;case W.PushToDeafen:M.isInCall&&(le(ie.Release),M.toggleDeafen(!1));break;default:x.info("unhandled keybind "+U.action)}}function F(){const _=B(P.state.font),U=B(P.state.allFonts);let Y="";Y=U.map(({text:ce,value:ee})=>{const V=_&&_.value===ee;if(ee.startsWith("blob:")&&V)return`
                @font-face {
                    font-family: '${ce}';
                    src: url('${ee}'); // Use the blob URL directly
                    font-weight: normal;
                    font-style: normal;
                }`;if(!ee.startsWith("blob:")&&V){const T=$n(ce);return`
                @font-face {
                    font-family: '${ce}';
                    src: ${T}; // Load only valid formats
                    font-weight: normal;
                    font-style: normal;
                }`}}).filter(Boolean).join(`
`);const be=_.text||g.text;return`
        ${Y}
        :root {
            --font-size: ${c.toFixed(2)}rem;
            --primary-color: ${o};
            --primary-font: '${be}'; // Ensure primary font is set
        }
        .emoji {
            font-family: '${i}';
        }
        .theme {
            font-family: '${p}';
        }
    `}let O=F();pn(F()),P.state.color.subscribe(_=>{o=_,n(3,O=F())}),P.state.fontSize.subscribe(_=>{c=_,n(3,O=F())}),P.state.cssOverride.subscribe(_=>{n(2,f=_),n(3,O=F())}),P.state.font.subscribe(_=>{g=_,n(3,O=F())}),P.state.allFonts.subscribe(_=>{n(3,O=F())}),P.state.emojiFont.subscribe(_=>{i=_,n(3,O=F())}),P.state.theme.subscribe(_=>{n(1,p=_),n(3,O=F())}),Ee.state.subscribe(_=>{n(0,u=_.keybinds),_.devmode}),R.state.devices.muted.subscribe(_=>m=_),R.state.devices.deafened.subscribe(_=>$=_),window.addEventListener("click",()=>{Z(),x.debug("Audio context unlocked after click.")},{once:!0}),window.addEventListener("touchstart",()=>{Z(),x.debug("Audio context unlocked after touch.")},{once:!0});function Z(){const _=new window.AudioContext;_.state==="suspended"&&_.resume().then(()=>{x.info("Audio context unlocked.")})}let K=!1;ke(async()=>{await lt(t.route.id),await gt(),F()});const ae=()=>P.toggleMarket(),X=()=>{P.closeSidebar()},q=()=>{P.openSidebar()};return r.$$set=_=>{"$$scope"in _&&n(8,l=_.$$scope)},r.$$.update=()=>{r.$$.dirty&128&&s&&n(4,K=!0)},[u,p,f,O,K,b,D,s,l,a,ae,X,q]}class On extends ne{constructor(e){super(),se(this,e,gn,mn,te,{})}}export{On as component,zn as universal};

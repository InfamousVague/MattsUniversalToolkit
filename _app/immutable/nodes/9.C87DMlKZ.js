import{s as ye,e as Y,a as j,Q as Be,c as H,b as U,g as X,S as Oe,f as w,l as k,i as N,h as V,t as Ae,d as Ee,p as me,Y as At,j as je,H as De,_ as Sn,r as In,k as Ve,v as yn,M as Ie,N as Et,w as le,n as K,x as oe,$ as he,y as An,V as En}from"../chunks/scheduler.BSglW4Eu.js";import{S as Xe,i as Ge,c as S,a as I,m as y,t as $,b,e as A,g as q,d as J,f as Dt}from"../chunks/index.B6nwG8t1.js";import{e as ie,A as Dn,T as at}from"../chunks/UnderConstruction.svelte_svelte_type_style_lang.B9_NotwT.js";import{B as fe,I as ue}from"../chunks/Icon.DiMEB9BF.js";import{a as D,A as R,V as Tn,O as x,b as B,U as be,W as O,R as Tt,$ as Rn,X as st,z as ee,v as Pn,p as Ln,M as Nn,o as ve,C as Mn,S as Rt}from"../chunks/Store.USTN8Ag4.js";import{w as it,g as zn}from"../chunks/entry.Bbrar38T.js";import{L as ot}from"../chunks/Label.D9B1jxLM.js";import{C as Bn}from"../chunks/Controls.DL7Yowtp.js";import"../chunks/Role.svelte_svelte_type_style_lang.1avG_s1_.js";import{C as On}from"../chunks/ChatPreview.CAnWaaWm.js";import{C as Vn,I as Un,F as Pt}from"../chunks/ChatFilter.D_gWcg_o.js";import{P as jn}from"../chunks/ProfilePicture.CIXl7MZm.js";import{P as Xn}from"../chunks/ProfilePictureMany.CNkm2cCh.js";import{M as Gn}from"../chunks/Modal.BzmLuL3Z.js";import{C as We}from"../chunks/ContextMenu.DRItxTAU.js";import{I as Wn}from"../chunks/ImageEmbed.BfNUuvRs.js";import{S as Yn}from"../chunks/Slimbar.bHN6r-F3.js";import{T as Hn}from"../chunks/Topbar.DKFLULzB.js";function qn(l){let e,t;return e=new ue({props:{icon:l[0]}}),{c(){S(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},p(n,r){const a={};r&1&&(a.icon=n[0]),e.$set(a)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Jn(l){let e,t,n,r,a,s,i;return t=new fe({props:{icon:!0,appearance:l[1],$$slots:{default:[qn]},$$scope:{ctx:l}}}),{c(){e=Y("div"),S(t.$$.fragment),n=j(),r=Be("svg"),a=Be("circle"),s=Be("circle"),this.h()},l(o){e=H(o,"DIV",{class:!0});var c=U(e);I(t.$$.fragment,c),n=X(c),r=Oe(c,"svg",{class:!0,width:!0,height:!0,version:!0,xmlns:!0});var d=U(r);a=Oe(d,"circle",{r:!0,cx:!0,cy:!0,fill:!0,"stroke-dasharray":!0,"stroke-dashoffset":!0,class:!0}),U(a).forEach(w),s=Oe(d,"circle",{class:!0,r:!0,cx:!0,cy:!0,fill:!0,"stroke-dasharray":!0,"stroke-dashoffset":!0}),U(s).forEach(w),d.forEach(w),c.forEach(w),this.h()},h(){k(a,"r","21.6"),k(a,"cx","24"),k(a,"cy","24"),k(a,"fill","transparent"),k(a,"stroke-dasharray","135.72"),k(a,"stroke-dashoffset","0"),k(a,"class","svelte-1oktdk9"),k(s,"class","bar svelte-1oktdk9"),k(s,"r","21.6"),k(s,"cx","24"),k(s,"cy","24"),k(s,"fill","transparent"),k(s,"stroke-dasharray","135.72"),k(s,"stroke-dashoffset","12"),k(r,"class","svg primary svelte-1oktdk9"),k(r,"width","48"),k(r,"height","48"),k(r,"version","1.1"),k(r,"xmlns","http://www.w3.org/2000/svg"),k(e,"class","progress-button svelte-1oktdk9")},m(o,c){N(o,e,c),y(t,e,null),V(e,n),V(e,r),V(r,a),V(r,s),i=!0},p(o,[c]){const d={};c&2&&(d.appearance=o[1]),c&5&&(d.$$scope={dirty:c,ctx:o}),t.$set(d)},i(o){i||($(t.$$.fragment,o),i=!0)},o(o){b(t.$$.fragment,o),i=!1},d(o){o&&w(e),A(t)}}}function Kn(l,e,t){let{icon:n=D.Beaker}=e,{appearance:r=R.Default}=e;return l.$$set=a=>{"icon"in a&&t(0,n=a.icon),"appearance"in a&&t(1,r=a.appearance)},[n,r]}class Qn extends Xe{constructor(e){super(),Ge(this,e,Kn,Jn,ye,{icon:0,appearance:1})}}function ft(l,e,t){const n=l.slice();return n[5]=e[t],n}function ut(l){let e,t,n,r=ie(l[0].items),a=[];for(let i=0;i<r.length;i+=1)a[i]=ct(ft(l,r,i));const s=i=>b(a[i],1,1,()=>{a[i]=null});return{c(){e=Y("ul");for(let i=0;i<a.length;i+=1)a[i].c();this.h()},l(i){e=H(i,"UL",{"data-cy":!0,class:!0});var o=U(e);for(let c=0;c<a.length;c+=1)a[c].l(o);o.forEach(w),this.h()},h(){k(e,"data-cy",t=`tree-folder-${l[0].name}`),k(e,"class","svelte-1nty578")},m(i,o){N(i,e,o);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(e,null);n=!0},p(i,o){if(o&7){r=ie(i[0].items);let c;for(c=0;c<r.length;c+=1){const d=ft(i,r,c);a[c]?(a[c].p(d,o),$(a[c],1)):(a[c]=ct(d),a[c].c(),$(a[c],1),a[c].m(e,null))}for(q(),c=r.length;c<a.length;c+=1)s(c);J()}(!n||o&1&&t!==(t=`tree-folder-${i[0].name}`))&&k(e,"data-cy",t)},i(i){if(!n){for(let o=0;o<r.length;o+=1)$(a[o]);n=!0}},o(i){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)b(a[o]);n=!1},d(i){i&&w(e),De(a,i)}}}function ct(l){let e,t;return e=new Lt({props:{file:l[5],openFolders:l[1],toggleFolder:l[2]}}),{c(){S(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},p(n,r){const a={};r&1&&(a.file=n[5]),r&2&&(a.openFolders=n[1]),r&4&&(a.toggleFolder=n[2]),e.$set(a)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Zn(l){let e,t,n,r,a=l[0].extension===""?`${l[0].displayName}`:`${l[0].displayName}.${l[0].extension}`,s,i,o,c,d,u,g;n=new ue({props:{icon:l[3](),muted:!0,filled:!0}});let m=l[1][l[0].id]&&l[0].items&&l[0].items.length>0&&ut(l);return{c(){e=Y("li"),t=Y("div"),S(n.$$.fragment),r=j(),s=Ae(a),i=j(),m&&m.c(),this.h()},l(h){e=H(h,"LI",{"data-cy":!0,class:!0});var P=U(e);t=H(P,"DIV",{class:!0,"data-cy":!0});var F=U(t);I(n.$$.fragment,F),r=X(F),s=Ee(F,a),i=X(F),m&&m.l(F),F.forEach(w),P.forEach(w),this.h()},h(){k(t,"class","tree svelte-1nty578"),k(t,"data-cy",o=`tree-item-${l[0].name}`),k(e,"data-cy",c=`tree-node-${l[0].name}`),k(e,"class","svelte-1nty578")},m(h,P){N(h,e,P),V(e,t),y(n,t,null),V(t,r),V(t,s),V(t,i),m&&m.m(t,null),d=!0,u||(g=me(e,"click",function(){At(l[4](l[0],!1))&&l[4](l[0],!1).apply(this,arguments)}),u=!0)},p(h,[P]){l=h;const F={};P&8&&(F.icon=l[3]()),n.$set(F),(!d||P&1)&&a!==(a=l[0].extension===""?`${l[0].displayName}`:`${l[0].displayName}.${l[0].extension}`)&&je(s,a),l[1][l[0].id]&&l[0].items&&l[0].items.length>0?m?(m.p(l,P),P&3&&$(m,1)):(m=ut(l),m.c(),$(m,1),m.m(t,null)):m&&(q(),b(m,1,1,()=>{m=null}),J()),(!d||P&1&&o!==(o=`tree-item-${l[0].name}`))&&k(t,"data-cy",o),(!d||P&1&&c!==(c=`tree-node-${l[0].name}`))&&k(e,"data-cy",c)},i(h){d||($(n.$$.fragment,h),$(m),d=!0)},o(h){b(n.$$.fragment,h),b(m),d=!1},d(h){h&&w(e),A(n),m&&m.d(),u=!1,g()}}}function xn(l,e,t){let n,{file:r}=e,{openFolders:a}=e,{toggleFolder:s}=e;function i(o,c){return function(d){d.stopPropagation(),c&&d.preventDefault(),s(o.id)}}return l.$$set=o=>{"file"in o&&t(0,r=o.file),"openFolders"in o&&t(1,a=o.openFolders),"toggleFolder"in o&&t(2,s=o.toggleFolder)},l.$$.update=()=>{l.$$.dirty&3&&t(3,n=()=>{var o,c;if(!a[r.id]&&r.type==="folder")return D.Folder;if(a[r.id]&&r.type==="folder"&&!((o=r.items)!=null&&o.length))return D.Folder;if(a[r.id]&&((c=r.items)!=null&&c.length)&&r.type==="folder")return D.FolderOpen;if(r.type==="file")return D.Document;if(r.type==="image")return D.Image})},[r,a,s,n,i]}class Lt extends Xe{constructor(e){super(),Ge(this,e,xn,Zn,ye,{file:0,openFolders:1,toggleFolder:2})}}function re(l){if(typeof l!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(l))}function mt(l,e){for(var t="",n=0,r=-1,a=0,s,i=0;i<=l.length;++i){if(i<l.length)s=l.charCodeAt(i);else{if(s===47)break;s=47}if(s===47){if(!(r===i-1||a===1))if(r!==i-1&&a===2){if(t.length<2||n!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var o=t.lastIndexOf("/");if(o!==t.length-1){o===-1?(t="",n=0):(t=t.slice(0,o),n=t.length-1-t.lastIndexOf("/")),r=i,a=0;continue}}else if(t.length===2||t.length===1){t="",n=0,r=i,a=0;continue}}e&&(t.length>0?t+="/..":t="..",n=2)}else t.length>0?t+="/"+l.slice(r+1,i):t=l.slice(r+1,i),n=i-r-1;r=i,a=0}else s===46&&a!==-1?++a:a=-1}return t}function er(l,e){var t=e.dir||e.root,n=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+n:t+l+n:n}var de={resolve:function(){for(var e="",t=!1,n,r=arguments.length-1;r>=-1&&!t;r--){var a;r>=0?a=arguments[r]:(n===void 0&&(n=Dn.cwd()),a=n),re(a),a.length!==0&&(e=a+"/"+e,t=a.charCodeAt(0)===47)}return e=mt(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(re(e),e.length===0)return".";var t=e.charCodeAt(0)===47,n=e.charCodeAt(e.length-1)===47;return e=mt(e,!t),e.length===0&&!t&&(e="."),e.length>0&&n&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return re(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var n=arguments[t];re(n),n.length>0&&(e===void 0?e=n:e+="/"+n)}return e===void 0?".":de.normalize(e)},relative:function(e,t){if(re(e),re(t),e===t||(e=de.resolve(e),t=de.resolve(t),e===t))return"";for(var n=1;n<e.length&&e.charCodeAt(n)===47;++n);for(var r=e.length,a=r-n,s=1;s<t.length&&t.charCodeAt(s)===47;++s);for(var i=t.length,o=i-s,c=a<o?a:o,d=-1,u=0;u<=c;++u){if(u===c){if(o>c){if(t.charCodeAt(s+u)===47)return t.slice(s+u+1);if(u===0)return t.slice(s+u)}else a>c&&(e.charCodeAt(n+u)===47?d=u:u===0&&(d=0));break}var g=e.charCodeAt(n+u),m=t.charCodeAt(s+u);if(g!==m)break;g===47&&(d=u)}var h="";for(u=n+d+1;u<=r;++u)(u===r||e.charCodeAt(u)===47)&&(h.length===0?h+="..":h+="/..");return h.length>0?h+t.slice(s+d):(s+=d,t.charCodeAt(s)===47&&++s,t.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(re(e),e.length===0)return".";for(var t=e.charCodeAt(0),n=t===47,r=-1,a=!0,s=e.length-1;s>=1;--s)if(t=e.charCodeAt(s),t===47){if(!a){r=s;break}}else a=!1;return r===-1?n?"/":".":n&&r===1?"//":e.slice(0,r)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');re(e);var n=0,r=-1,a=!0,s;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var i=t.length-1,o=-1;for(s=e.length-1;s>=0;--s){var c=e.charCodeAt(s);if(c===47){if(!a){n=s+1;break}}else o===-1&&(a=!1,o=s+1),i>=0&&(c===t.charCodeAt(i)?--i===-1&&(r=s):(i=-1,r=o))}return n===r?r=o:r===-1&&(r=e.length),e.slice(n,r)}else{for(s=e.length-1;s>=0;--s)if(e.charCodeAt(s)===47){if(!a){n=s+1;break}}else r===-1&&(a=!1,r=s+1);return r===-1?"":e.slice(n,r)}},extname:function(e){re(e);for(var t=-1,n=0,r=-1,a=!0,s=0,i=e.length-1;i>=0;--i){var o=e.charCodeAt(i);if(o===47){if(!a){n=i+1;break}continue}r===-1&&(a=!1,r=i+1),o===46?t===-1?t=i:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||r===-1||s===0||s===1&&t===r-1&&t===n+1?"":e.slice(t,r)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return er("/",e)},parse:function(e){re(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var n=e.charCodeAt(0),r=n===47,a;r?(t.root="/",a=1):a=0;for(var s=-1,i=0,o=-1,c=!0,d=e.length-1,u=0;d>=a;--d){if(n=e.charCodeAt(d),n===47){if(!c){i=d+1;break}continue}o===-1&&(c=!1,o=d+1),n===46?s===-1?s=d:u!==1&&(u=1):s!==-1&&(u=-1)}return s===-1||o===-1||u===0||u===1&&s===o-1&&s===i+1?o!==-1&&(i===0&&r?t.base=t.name=e.slice(1,o):t.base=t.name=e.slice(i,o)):(i===0&&r?(t.name=e.slice(1,s),t.base=e.slice(1,o)):(t.name=e.slice(i,s),t.base=e.slice(i,o)),t.ext=e.slice(s,o)),i>0?t.dir=e.slice(0,i-1):r&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};de.posix=de;var tr=de;const nr=Tn(tr);function dt(l,e,t){const n=l.slice();return n[81]=e[t],n[82]=e,n[83]=t,n}function gt(l,e,t){const n=l.slice();return n[85]=e[t],n}function $t(l,e,t){const n=l.slice();return n[88]=e[t],n}function pt(l){let e,t;return e=new Gn({props:{$$slots:{controls:[ar],default:[rr]},$$scope:{ctx:l}}}),e.$on("close",l[42]),{c(){S(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},p(n,r){const a={};r[0]&16|r[2]&536870912&&(a.$$scope={dirty:r,ctx:n}),e.$set(a)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function rr(l){let e,t;return e=new Wn({props:{big:!0,source:l[4]}}),{c(){S(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},p(n,r){const a={};r[0]&16&&(a.source=n[4]),e.$set(a)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function lr(l){let e,t;return e=new ue({props:{icon:D.XMark}}),{c(){S(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},p:K,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function ar(l){let e,t;return e=new fe({props:{icon:!0,small:!0,appearance:R.Alt,$$slots:{default:[lr]},$$scope:{ctx:l}}}),e.$on("click",l[41]),{c(){S(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},p(n,r){const a={};r[2]&536870912&&(a.$$scope={dirty:r,ctx:n}),e.$set(a)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function _t(l){let e,t,n;function r(s){l[49](s)}let a={loading:Ye,open:l[19],activeRoute:Tt.Files,$$slots:{default:[ur]},$$scope:{ctx:l}};return l[5]!==void 0&&(a.search=l[5]),e=new Yn({props:a}),Ie.push(()=>Dt(e,"search",r)),e.$on("toggle",l[24]),e.$on("search",l[50]),e.$on("enter",l[35]),{c(){S(e.$$.fragment)},l(s){I(e.$$.fragment,s)},m(s,i){y(e,s,i),n=!0},p(s,i){const o={};i[0]&524288&&(o.open=s[19]),i[0]&1507434|i[2]&536870912&&(o.$$scope={dirty:i,ctx:s}),!t&&i[0]&32&&(t=!0,o.search=s[5],Et(()=>t=!1)),e.$set(o)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){b(e.$$.fragment,s),n=!1},d(s){A(e,s)}}}function sr(l){let e,t;return e=new ue({props:{icon:D.ChatBubble}}),{c(){S(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},p:K,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function ir(l){let e,t;return e=new ue({props:{icon:D.Folder}}),{c(){S(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},p:K,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function or(l){let e,t,n,r;return e=new fe({props:{appearance:l[3]==="chats"?R.Primary:R.Alt,text:l[17]("chat.chat_plural"),$$slots:{default:[sr]},$$scope:{ctx:l}}}),e.$on("click",l[45]),n=new fe({props:{appearance:l[3]==="files"?R.Primary:R.Alt,text:l[17]("files.file_plural"),$$slots:{default:[ir]},$$scope:{ctx:l}}}),n.$on("click",l[46]),{c(){S(e.$$.fragment),t=j(),S(n.$$.fragment)},l(a){I(e.$$.fragment,a),t=X(a),I(n.$$.fragment,a)},m(a,s){y(e,a,s),N(a,t,s),y(n,a,s),r=!0},p(a,s){const i={};s[0]&8&&(i.appearance=a[3]==="chats"?R.Primary:R.Alt),s[0]&131072&&(i.text=a[17]("chat.chat_plural")),s[2]&536870912&&(i.$$scope={dirty:s,ctx:a}),e.$set(i);const o={};s[0]&8&&(o.appearance=a[3]==="files"?R.Primary:R.Alt),s[0]&131072&&(o.text=a[17]("files.file_plural")),s[2]&536870912&&(o.$$scope={dirty:s,ctx:a}),n.$set(o)},i(a){r||($(e.$$.fragment,a),$(n.$$.fragment,a),r=!0)},o(a){b(e.$$.fragment,a),b(n.$$.fragment,a),r=!1},d(a){a&&w(t),A(e,a),A(n,a)}}}function ht(l){let e,t,n=ie(l[20].slice().sort(l[47])),r=[];for(let s=0;s<n.length;s+=1)r[s]=bt($t(l,n,s));const a=s=>b(r[s],1,1,()=>{r[s]=null});return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=le()},l(s){for(let i=0;i<r.length;i+=1)r[i].l(s);e=le()},m(s,i){for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(s,i);N(s,e,i),t=!0},p(s,i){if(i[0]&1179650|i[2]&4194304){n=ie(s[20].slice().sort(s[47]));let o;for(o=0;o<n.length;o+=1){const c=$t(s,n,o);r[o]?(r[o].p(c,i),$(r[o],1)):(r[o]=bt(c),r[o].c(),$(r[o],1),r[o].m(e.parentNode,e))}for(q(),o=n.length;o<r.length;o+=1)a(o);J()}},i(s){if(!t){for(let i=0;i<n.length;i+=1)$(r[i]);t=!0}},o(s){r=r.filter(Boolean);for(let i=0;i<r.length;i+=1)b(r[i]);t=!1},d(s){s&&w(e),De(r,s)}}}function fr(l){let e,t;return e=new On({props:{slot:"content",chat:l[88],loading:Ye,cta:l[1]===l[88]}}),e.$on("contextmenu",function(){At(l[84])&&l[84].apply(this,arguments)}),{c(){S(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},p(n,r){l=n;const a={};r[0]&1048576&&(a.chat=l[88]),r[0]&1048578&&(a.cta=l[1]===l[88]),e.$set(a)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function bt(l){let e,t;function n(){return l[48](l[88])}return e=new We({props:{items:[{id:"hide",icon:D.EyeSlash,text:l[17]("chat.hide"),appearance:R.Default,onClick:n},{id:"mark_read",icon:D.CheckMark,text:l[17]("chat.markRead"),appearance:R.Default,onClick:yt}],$$slots:{content:[fr,({open:r})=>({84:r}),({open:r})=>[0,0,r?4194304:0]]},$$scope:{ctx:l}}}),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,a){y(e,r,a),t=!0},p(r,a){l=r;const s={};a[0]&1179648&&(s.items=[{id:"hide",icon:D.EyeSlash,text:l[17]("chat.hide"),appearance:R.Default,onClick:n},{id:"mark_read",icon:D.CheckMark,text:l[17]("chat.markRead"),appearance:R.Default,onClick:yt}]),a[0]&1048578|a[2]&541065216&&(s.$$scope={dirty:a,ctx:l}),e.$set(s)},i(r){t||($(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){A(e,r)}}}function vt(l){let e,t,n=ie(l[16]),r=[];for(let s=0;s<n.length;s+=1)r[s]=kt(gt(l,n,s));const a=s=>b(r[s],1,1,()=>{r[s]=null});return{c(){e=Y("ul");for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=H(s,"UL",{class:!0});var i=U(e);for(let o=0;o<r.length;o+=1)r[o].l(i);i.forEach(w),this.h()},h(){k(e,"class","folderList svelte-2a8dk3")},m(s,i){N(s,e,i);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(e,null);t=!0},p(s,i){if(i[0]&33882112){n=ie(s[16]);let o;for(o=0;o<n.length;o+=1){const c=gt(s,n,o);r[o]?(r[o].p(c,i),$(r[o],1)):(r[o]=kt(c),r[o].c(),$(r[o],1),r[o].m(e,null))}for(q(),o=n.length;o<r.length;o+=1)a(o);J()}},i(s){if(!t){for(let i=0;i<n.length;i+=1)$(r[i]);t=!0}},o(s){r=r.filter(Boolean);for(let i=0;i<r.length;i+=1)b(r[i]);t=!1},d(s){s&&w(e),De(r,s)}}}function kt(l){let e,t;return e=new Lt({props:{file:l[85],openFolders:l[18],toggleFolder:l[25]}}),{c(){S(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},p(n,r){const a={};r[0]&65536&&(a.file=n[85]),r[0]&262144&&(a.openFolders=n[18]),e.$set(a)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function ur(l){let e,t,n,r,a,s,i,o;function c(m){l[44](m)}let d={};l[5]!==void 0&&(d.filter=l[5]),e=new Vn({props:d}),l[43](e),Ie.push(()=>Dt(e,"filter",c)),r=new Bn({props:{$$slots:{default:[or]},$$scope:{ctx:l}}});let u=l[3]==="chats"&&ht(l),g=l[3]==="files"&&vt(l);return{c(){S(e.$$.fragment),n=j(),S(r.$$.fragment),a=j(),u&&u.c(),s=j(),g&&g.c(),i=le()},l(m){I(e.$$.fragment,m),n=X(m),I(r.$$.fragment,m),a=X(m),u&&u.l(m),s=X(m),g&&g.l(m),i=le()},m(m,h){y(e,m,h),N(m,n,h),y(r,m,h),N(m,a,h),u&&u.m(m,h),N(m,s,h),g&&g.m(m,h),N(m,i,h),o=!0},p(m,h){const P={};!t&&h[0]&32&&(t=!0,P.filter=m[5],Et(()=>t=!1)),e.$set(P);const F={};h[0]&131080|h[2]&536870912&&(F.$$scope={dirty:h,ctx:m}),r.$set(F),m[3]==="chats"?u?(u.p(m,h),h[0]&8&&$(u,1)):(u=ht(m),u.c(),$(u,1),u.m(s.parentNode,s)):u&&(q(),b(u,1,1,()=>{u=null}),J()),m[3]==="files"?g?(g.p(m,h),h[0]&8&&$(g,1)):(g=vt(m),g.c(),$(g,1),g.m(i.parentNode,i)):g&&(q(),b(g,1,1,()=>{g=null}),J())},i(m){o||($(e.$$.fragment,m),$(r.$$.fragment,m),$(u),$(g),o=!0)},o(m){b(e.$$.fragment,m),b(r.$$.fragment,m),b(u),b(g),o=!1},d(m){m&&(w(n),w(a),w(s),w(i)),l[43](null),A(e,m),A(r,m),u&&u.d(m),g&&g.d(m)}}}function cr(l){let e;return{c(){e=Ae(l[21])},l(t){e=Ee(t,l[21])},m(t,n){N(t,e,n)},p(t,n){n[0]&2097152&&je(e,t[21])},d(t){t&&w(e)}}}function mr(l){let e=Ln(O.MAX_STORAGE_SIZE)+"",t;return{c(){t=Ae(e)},l(n){t=Ee(n,e)},m(n,r){N(n,t,r)},p:K,d(n){n&&w(t)}}}function dr(l){let e,t,n,r,a,s,i,o,c;return n=new ot({props:{text:l[17]("files.freeSpace")}}),r=new at({props:{singleLine:!0,$$slots:{default:[cr]},$$scope:{ctx:l}}}),i=new ot({props:{text:l[17]("files.totalSpace")}}),o=new at({props:{singleLine:!0,$$slots:{default:[mr]},$$scope:{ctx:l}}}),{c(){e=Y("div"),t=Y("button"),S(n.$$.fragment),S(r.$$.fragment),a=j(),s=Y("button"),S(i.$$.fragment),S(o.$$.fragment),this.h()},l(d){e=H(d,"DIV",{slot:!0,class:!0});var u=U(e);t=H(u,"BUTTON",{class:!0});var g=U(t);I(n.$$.fragment,g),I(r.$$.fragment,g),g.forEach(w),a=X(u),s=H(u,"BUTTON",{class:!0});var m=U(s);I(i.$$.fragment,m),I(o.$$.fragment,m),m.forEach(w),u.forEach(w),this.h()},h(){k(t,"class","stat svelte-2a8dk3"),k(s,"class","stat svelte-2a8dk3"),k(e,"slot","before"),k(e,"class","before svelte-2a8dk3")},m(d,u){N(d,e,u),V(e,t),y(n,t,null),y(r,t,null),V(e,a),V(e,s),y(i,s,null),y(o,s,null),c=!0},p(d,u){const g={};u[0]&131072&&(g.text=d[17]("files.freeSpace")),n.$set(g);const m={};u[0]&2097152|u[2]&536870912&&(m.$$scope={dirty:u,ctx:d}),r.$set(m);const h={};u[0]&131072&&(h.text=d[17]("files.totalSpace")),i.$set(h);const P={};u[2]&536870912&&(P.$$scope={dirty:u,ctx:d}),o.$set(P)},i(d){c||($(n.$$.fragment,d),$(r.$$.fragment,d),$(i.$$.fragment,d),$(o.$$.fragment,d),c=!0)},o(d){b(n.$$.fragment,d),b(r.$$.fragment,d),b(i.$$.fragment,d),b(o.$$.fragment,d),c=!1},d(d){d&&w(e),A(n),A(r),A(i),A(o)}}}function wt(l){let e,t,n,r,a,s,i,o,c,d;return e=new fe({props:{appearance:R.Alt,icon:!0,tooltip:l[17]("files.new_folder"),$$slots:{default:[gr]},$$scope:{ctx:l}}}),e.$on("click",l[30]),n=new fe({props:{appearance:R.Alt,icon:!0,tooltip:l[17]("files.upload"),$$slots:{default:[$r]},$$scope:{ctx:l}}}),n.$on("click",l[51]),i=new Qn({props:{appearance:R.Alt,icon:D.ArrowsUpDown}}),{c(){S(e.$$.fragment),t=j(),S(n.$$.fragment),r=j(),a=Y("input"),s=j(),S(i.$$.fragment),this.h()},l(u){I(e.$$.fragment,u),t=X(u),I(n.$$.fragment,u),r=X(u),a=H(u,"INPUT",{style:!0,type:!0}),s=X(u),I(i.$$.fragment,u),this.h()},h(){En(a,"display","none"),a.multiple=!0,k(a,"type","file")},m(u,g){y(e,u,g),N(u,t,g),y(n,u,g),N(u,r,g),N(u,a,g),l[53](a),N(u,s,g),y(i,u,g),o=!0,c||(d=me(a,"change",l[52]),c=!0)},p(u,g){const m={};g[0]&131072&&(m.tooltip=u[17]("files.new_folder")),g[2]&536870912&&(m.$$scope={dirty:g,ctx:u}),e.$set(m);const h={};g[0]&131072&&(h.tooltip=u[17]("files.upload")),g[2]&536870912&&(h.$$scope={dirty:g,ctx:u}),n.$set(h)},i(u){o||($(e.$$.fragment,u),$(n.$$.fragment,u),$(i.$$.fragment,u),o=!0)},o(u){b(e.$$.fragment,u),b(n.$$.fragment,u),b(i.$$.fragment,u),o=!1},d(u){u&&(w(t),w(r),w(a),w(s)),A(e,u),A(n,u),l[53](null),A(i,u),c=!1,d()}}}function gr(l){let e,t;return e=new ue({props:{icon:D.FolderPlus}}),{c(){S(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},p:K,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function $r(l){let e,t;return e=new ue({props:{icon:D.Plus}}),{c(){S(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},p:K,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function pr(l){let e,t,n=!l[0]&&wt(l);return{c(){n&&n.c(),e=le()},l(r){n&&n.l(r),e=le()},m(r,a){n&&n.m(r,a),N(r,e,a),t=!0},p(r,a){r[0]?n&&(q(),b(n,1,1,()=>{n=null}),J()):n?(n.p(r,a),a[0]&1&&$(n,1)):(n=wt(r),n.c(),$(n,1),n.m(e.parentNode,e))},i(r){t||($(n),t=!0)},o(r){b(n),t=!1},d(r){r&&w(e),n&&n.d(r)}}}function Ft(l){let e,t,n;return t=new fe({props:{small:!0,appearance:R.Alt,class:"folder-back",$$slots:{default:[_r]},$$scope:{ctx:l}}}),t.$on("click",l[28]),{c(){e=Y("div"),S(t.$$.fragment),this.h()},l(r){e=H(r,"DIV",{class:!0});var a=U(e);I(t.$$.fragment,a),a.forEach(w),this.h()},h(){k(e,"class","folder-back svelte-2a8dk3")},m(r,a){N(r,e,a),y(t,e,null),n=!0},p(r,a){const s={};a[0]&131072|a[2]&536870912&&(s.$$scope={dirty:a,ctx:r}),t.$set(s)},i(r){n||($(t.$$.fragment,r),n=!0)},o(r){b(t.$$.fragment,r),n=!1},d(r){r&&w(e),A(t)}}}function _r(l){let e=l[17]("controls.go_back")+"",t;return{c(){t=Ae(e)},l(n){t=Ee(n,e)},m(n,r){N(n,t,r)},p(n,r){r[0]&131072&&e!==(e=n[17]("controls.go_back")+"")&&je(t,e)},d(n){n&&w(t)}}}function hr(l){let e,t;function n(...r){return l[65](l[81],...r)}return e=new Un({props:{filesize:l[81].size,name:l[81].name,ImgSource:l[81].source}}),e.$on("click",n),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,a){y(e,r,a),t=!0},p(r,a){l=r;const s={};a[0]&65536&&(s.filesize=l[81].size),a[0]&65536&&(s.name=l[81].name),a[0]&65536&&(s.ImgSource=l[81].source),e.$set(s)},i(r){t||($(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){A(e,r)}}}function br(l){let e,t,n,r=l[81].chat&&Ct(l);function a(){return l[62](l[81])}function s(){return l[63](l[81])}return t=new We({props:{items:[{id:"delete-"+l[81].id,icon:D.XMark,text:l[17]("generic.delete"),appearance:R.Default,onClick:a},{id:"rename-"+l[81].id,icon:D.Pencil,text:l[17]("files.rename"),appearance:R.Default,onClick:s}],$$slots:{content:[Fr,({open:i})=>({84:i}),({open:i})=>[0,0,i?4194304:0]]},$$scope:{ctx:l}}}),t.$on("close",l[64]),{c(){r&&r.c(),e=j(),S(t.$$.fragment)},l(i){r&&r.l(i),e=X(i),I(t.$$.fragment,i)},m(i,o){r&&r.m(i,o),N(i,e,o),y(t,i,o),n=!0},p(i,o){l=i,l[81].chat?r?(r.p(l,o),o[0]&65536&&$(r,1)):(r=Ct(l),r.c(),$(r,1),r.m(e.parentNode,e)):r&&(q(),b(r,1,1,()=>{r=null}),J());const c={};o[0]&196608&&(c.items=[{id:"delete-"+l[81].id,icon:D.XMark,text:l[17]("generic.delete"),appearance:R.Default,onClick:a},{id:"rename-"+l[81].id,icon:D.Pencil,text:l[17]("files.rename"),appearance:R.Default,onClick:s}]),o[0]&65796|o[2]&541065216&&(c.$$scope={dirty:o,ctx:l}),t.$set(c)},i(i){n||($(r),$(t.$$.fragment,i),n=!0)},o(i){b(r),b(t.$$.fragment,i),n=!1},d(i){i&&w(e),r&&r.d(i),A(t,i)}}}function vr(l){let e,t;function n(){return l[56](l[81])}function r(){return l[57](l[81])}function a(){return l[58](l[81])}return e=new We({props:{items:[{id:`rename-${l[81].id}`,icon:D.Pencil,text:l[17]("files.rename"),appearance:R.Default,onClick:n},{id:"download-"+l[81].id,icon:D.ArrowDown,text:l[17]("files.download"),appearance:R.Default,onClick:r},{id:"delete-"+l[81].id,icon:D.Trash,text:l[17]("generic.delete"),appearance:R.Error,onClick:a}],$$slots:{content:[Cr,({open:s})=>({84:s}),({open:s})=>[0,0,s?4194304:0]]},$$scope:{ctx:l}}}),e.$on("close",l[59]),{c(){S(e.$$.fragment)},l(s){I(e.$$.fragment,s)},m(s,i){y(e,s,i),t=!0},p(s,i){l=s;const o={};i[0]&196608&&(o.items=[{id:`rename-${l[81].id}`,icon:D.Pencil,text:l[17]("files.rename"),appearance:R.Default,onClick:n},{id:"download-"+l[81].id,icon:D.ArrowDown,text:l[17]("files.download"),appearance:R.Default,onClick:r},{id:"delete-"+l[81].id,icon:D.Trash,text:l[17]("generic.delete"),appearance:R.Error,onClick:a}]),i[0]&65796|i[2]&541065216&&(o.$$scope={dirty:i,ctx:l}),e.$set(o)},i(s){t||($(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){A(e,s)}}}function Ct(l){let e,t,n,r;const a=[wr,kr],s=[];function i(o,c){return o[81].chat.kind===Mn.DirectMessage?0:1}return e=i(l),t=s[e]=a[e](l),{c(){t.c(),n=le()},l(o){t.l(o),n=le()},m(o,c){s[e].m(o,c),N(o,n,c),r=!0},p(o,c){let d=e;e=i(o),e===d?s[e].p(o,c):(q(),b(s[d],1,1,()=>{s[d]=null}),J(),t=s[e],t?t.p(o,c):(t=s[e]=a[e](o),t.c()),$(t,1),t.m(n.parentNode,n))},i(o){r||($(t),r=!0)},o(o){b(t),r=!1},d(o){o&&w(n),s[e].d(o)}}}function kr(l){let e,t,n;return t=new Xn({props:{users:Object.values(l[23]),size:Rt.Smaller,forceSize:!0}}),{c(){e=Y("div"),S(t.$$.fragment),this.h()},l(r){e=H(r,"DIV",{class:!0});var a=U(e);I(t.$$.fragment,a),a.forEach(w),this.h()},h(){k(e,"class","profile-picture-many-folder svelte-2a8dk3")},m(r,a){N(r,e,a),y(t,e,null),n=!0},p(r,a){const s={};a[0]&8388608&&(s.users=Object.values(r[23])),t.$set(s)},i(r){n||($(t.$$.fragment,r),n=!0)},o(r){b(t.$$.fragment,r),n=!1},d(r){r&&w(e),A(t)}}}function wr(l){var r,a,s;let e,t,n;return t=new jn({props:{typing:l[81].chat.typing_indicator.size>0,id:(r=l[23][l[81].chat.users[1]])==null?void 0:r.key,image:(a=l[23][l[81].chat.users[1]])==null?void 0:a.profile.photo.image,frame:(s=l[23][l[81].chat.users[1]])==null?void 0:s.profile.photo.frame,size:Rt.Smaller,noIndicator:!0,loading:Ye}}),{c(){e=Y("div"),S(t.$$.fragment),this.h()},l(i){e=H(i,"DIV",{class:!0});var o=U(e);I(t.$$.fragment,o),o.forEach(w),this.h()},h(){k(e,"class","profile-picture-folder svelte-2a8dk3")},m(i,o){N(i,e,o),y(t,e,null),n=!0},p(i,o){var d,u,g;const c={};o[0]&65536&&(c.typing=i[81].chat.typing_indicator.size>0),o[0]&8454144&&(c.id=(d=i[23][i[81].chat.users[1]])==null?void 0:d.key),o[0]&8454144&&(c.image=(u=i[23][i[81].chat.users[1]])==null?void 0:u.profile.photo.image),o[0]&8454144&&(c.frame=(g=i[23][i[81].chat.users[1]])==null?void 0:g.profile.photo.frame),t.$set(c)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){b(t.$$.fragment,i),n=!1},d(i){i&&w(e),A(t)}}}function Fr(l){let e,t;function n(...a){return l[60](l[81],l[82],l[83],...a)}function r(...a){return l[61](l[84],...a)}return e=new Pt({props:{itemId:l[81].id,slot:"content",kind:ve.Folder,info:l[81],onRename:n,isRenaming:l[81].isRenaming}}),e.$on("contextmenu",r),{c(){S(e.$$.fragment)},l(a){I(e.$$.fragment,a)},m(a,s){y(e,a,s),t=!0},p(a,s){l=a;const i={};s[0]&65536&&(i.itemId=l[81].id),s[0]&65536&&(i.info=l[81]),s[0]&65792&&(i.onRename=n),s[0]&65536&&(i.isRenaming=l[81].isRenaming),e.$set(i)},i(a){t||($(e.$$.fragment,a),t=!0)},o(a){b(e.$$.fragment,a),t=!1},d(a){A(e,a)}}}function Cr(l){let e,t;function n(...a){return l[54](l[81],...a)}function r(...a){return l[55](l[84],...a)}return e=new Pt({props:{itemId:l[81].id,slot:"content",onRename:n,isRenaming:l[81].isRenaming,kind:l[81].imageThumbnail?ve.Image:ve.File,info:l[81]}}),e.$on("contextmenu",r),{c(){S(e.$$.fragment)},l(a){I(e.$$.fragment,a)},m(a,s){y(e,a,s),t=!0},p(a,s){l=a;const i={};s[0]&65536&&(i.itemId=l[81].id),s[0]&65792&&(i.onRename=n),s[0]&65536&&(i.isRenaming=l[81].isRenaming),s[0]&65536&&(i.kind=l[81].imageThumbnail?ve.Image:ve.File),s[0]&65536&&(i.info=l[81]),e.$set(i)},i(a){t||($(e.$$.fragment,a),t=!0)},o(a){b(e.$$.fragment,a),t=!1},d(a){A(e,a)}}}function St(l){let e,t,n,r,a,s,i;const o=[vr,br,hr],c=[];function d(u,g){return u[81].type==="file"?0:u[81].type==="folder"?1:u[81].type==="image"?2:-1}return~(t=d(l))&&(n=c[t]=o[t](l)),{c(){e=Y("div"),n&&n.c(),r=j(),this.h()},l(u){e=H(u,"DIV",{class:!0,draggable:!0,"data-id":!0});var g=U(e);n&&n.l(g),r=X(g),g.forEach(w),this.h()},h(){k(e,"class",a="draggable-item "+l[81].id+" "+(l[81].type==="folder"?"folder-draggable droppable":"")+" svelte-2a8dk3"),k(e,"draggable","true"),k(e,"data-id",s=l[81].id)},m(u,g){N(u,e,g),~t&&c[t].m(e,null),V(e,r),i=!0},p(u,g){let m=t;t=d(u),t===m?~t&&c[t].p(u,g):(n&&(q(),b(c[m],1,1,()=>{c[m]=null}),J()),~t?(n=c[t],n?n.p(u,g):(n=c[t]=o[t](u),n.c()),$(n,1),n.m(e,r)):n=null),(!i||g[0]&65536&&a!==(a="draggable-item "+u[81].id+" "+(u[81].type==="folder"?"folder-draggable droppable":"")+" svelte-2a8dk3"))&&k(e,"class",a),(!i||g[0]&65536&&s!==(s=u[81].id))&&k(e,"data-id",s)},i(u){i||($(n),i=!0)},o(u){b(n),i=!1},d(u){u&&w(e),~t&&c[t].d()}}}function It(l){let e=l[81],t,n,r=St(l);return{c(){r.c(),t=le()},l(a){r.l(a),t=le()},m(a,s){r.m(a,s),N(a,t,s),n=!0},p(a,s){s[0]&65536&&ye(e,e=a[81])?(q(),b(r,1,1,K),J(),r=St(a),r.c(),$(r,1),r.m(t.parentNode,t)):r.p(a,s)},i(a){n||($(r),n=!0)},o(a){b(r),n=!1},d(a){a&&w(t),r.d(a)}}}function Sr(l){let e,t,n,r,a,s,i,o,c,d,u,g=l[4]&&pt(l),m=!l[0]&&_t(l);a=new Hn({props:{$$slots:{controls:[pr],before:[dr]},$$scope:{ctx:l}}});let h=l[22]&&Ft(l),P=ie(l[16]),F=[];for(let C=0;C<P.length;C+=1)F[C]=It(dt(l,P,C));const Te=C=>b(F[C],1,1,()=>{F[C]=null});return{c(){e=Y("div"),g&&g.c(),t=j(),m&&m.c(),n=j(),r=Y("div"),S(a.$$.fragment),s=j(),h&&h.c(),i=j(),o=Y("div");for(let C=0;C<F.length;C+=1)F[C].c();this.h()},l(C){e=H(C,"DIV",{id:!0,class:!0});var E=U(e);g&&g.l(E),t=X(E),m&&m.l(E),n=X(E),r=H(E,"DIV",{class:!0});var G=U(r);I(a.$$.fragment,G),s=X(G),h&&h.l(G),i=X(G),o=H(G,"DIV",{class:!0});var z=U(o);for(let te=0;te<F.length;te+=1)F[te].l(z);z.forEach(w),G.forEach(w),E.forEach(w),this.h()},h(){k(o,"class","files svelte-2a8dk3"),k(r,"class","content svelte-2a8dk3"),k(e,"id","page"),k(e,"class","svelte-2a8dk3")},m(C,E){N(C,e,E),g&&g.m(e,null),V(e,t),m&&m.m(e,null),V(e,n),V(e,r),y(a,r,null),V(r,s),h&&h.m(r,null),V(r,i),V(r,o);for(let G=0;G<F.length;G+=1)F[G]&&F[G].m(o,null);c=!0,d||(u=[me(e,"dragover",Sn(l[40])),me(e,"dragenter",l[66]),me(e,"dragleave",l[33]),me(e,"drop",l[67])],d=!0)},p(C,E){C[4]?g?(g.p(C,E),E[0]&16&&$(g,1)):(g=pt(C),g.c(),$(g,1),g.m(e,t)):g&&(q(),b(g,1,1,()=>{g=null}),J()),C[0]?m&&(q(),b(m,1,1,()=>{m=null}),J()):m?(m.p(C,E),E[0]&1&&$(m,1)):(m=_t(C),m.c(),$(m,1),m.m(e,n));const G={};if(E[0]&2228353|E[2]&536870912&&(G.$$scope={dirty:E,ctx:C}),a.$set(G),C[22]?h?(h.p(C,E),E[0]&4194304&&$(h,1)):(h=Ft(C),h.c(),$(h,1),h.m(r,i)):h&&(q(),b(h,1,1,()=>{h=null}),J()),E[0]&545456404|E[1]&449|E[2]&4194304){P=ie(C[16]);let z;for(z=0;z<P.length;z+=1){const te=dt(C,P,z);F[z]?(F[z].p(te,E),$(F[z],1)):(F[z]=It(te),F[z].c(),$(F[z],1),F[z].m(o,null))}for(q(),z=P.length;z<F.length;z+=1)Te(z);J()}},i(C){if(!c){$(g),$(m),$(a.$$.fragment,C),$(h);for(let E=0;E<P.length;E+=1)$(F[E]);c=!0}},o(C){b(g),b(m),b(a.$$.fragment,C),b(h),F=F.filter(Boolean);for(let E=0;E<F.length;E+=1)b(F[E]);c=!1},d(C){C&&w(e),g&&g.d(),m&&m.d(),A(a),h&&h.d(),De(F,C),d=!1,In(u)}}}let Ye=!1;function Ue(l){const e=l.lastIndexOf(".");if(e===-1)return{name:l,extension:""};const t=l.substring(0,e),n=l.substring(e+1);return{name:t,extension:n}}function Ir(l){const e=Array.from(l).map(r=>String.fromCharCode(r)).join("");return`data:image/jpeg;base64,${btoa(e).replace("dataimage/jpegbase64","")}`}const yt=()=>{};function yr(l,e,t){let n,r,a,s,i,o,c,d,u=K,g=()=>(u(),u=oe(s,f=>t(16,d=f)),s),m,h,P,F=K,Te=()=>(F(),F=oe(a,f=>t(18,P=f)),a),C,E=K,G=()=>(E(),E=oe(c,f=>t(1,C=f)),c),z,te=K,Nt=()=>(te(),te=oe(n,f=>t(19,z=f)),n),He,Re=K,Mt=()=>(Re(),Re=oe(o,f=>t(20,He=f)),o),qe,Pe=K,zt=()=>(Pe(),Pe=oe(i,f=>t(21,qe=f)),i),Je,Ke,Le=K,Bt=()=>(Le(),Le=oe(r,f=>t(23,Ke=f)),r);Ve(l,Rn,f=>t(17,h=f)),l.$$.on_destroy.push(()=>u()),l.$$.on_destroy.push(()=>F()),l.$$.on_destroy.push(()=>E()),l.$$.on_destroy.push(()=>te()),l.$$.on_destroy.push(()=>Re()),l.$$.on_destroy.push(()=>Pe()),l.$$.on_destroy.push(()=>Le());let{browseFilesForChatMode:Qe=!1}=e,ge=!1,ke=0;function Ot(){be.toggleSidebar()}let Ne=["chats","files"][1];function Vt(f){const _=P,p={..._,[f]:!_[f]};B.updateFolderTree(p)}let we=0,Fe,$e,pe,ce,Ce=it("");Ve(l,Ce,f=>t(73,m=f));let Se,_e=it(!1);Ve(l,_e,f=>t(22,Je=f));async function Ut(f){(await O.openDirectory(f.name)).fold(p=>{},p=>{Ce.set(f.id),W()}),(await O.canGoBack()).fold(p=>{},p=>_e.set(p))}async function jt(){(await O.goBack()).fold(_=>{},_=>{Ce.set(_),W()}),(await O.canGoBack()).fold(_=>{},_=>_e.set(_))}async function Ze(f){if(f.isRenaming=x.Success,f.name===""){W(),f.isRenaming=x.Error;return}(await O.createDirectory(f.name)).fold(p=>{if(f.isRenaming=x.Error,p===st.DIRECTORY_ALREADY_EXIST){W(),B.addToastNotification(new ee("",h("files.itemAlreadyExistsWithSameName"),2));return}W(),B.addToastNotification(new ee("",p,2))},async p=>{W()})}function Xt(){let f={id:Pn(),type:"folder",size:0,icon:D.Folder,remotePath:"",name:"",displayName:"",source:"",extension:"",isRenaming:x.Loading,items:[],parentId:m};he(s,d=[...d,f],d),t(8,Se=f.id)}function Gt(f,_){function p(v,T,L){let M=L.find(Q=>Q.id===v&&Q.type==="folder");M&&(T.type==="folder"?O.dropIntoFolder(T.name,M.name):O.dropIntoFolder(`${T.name}.${T.extension}`,M.name))}p(_,f,d),W()}D.Folder,x.Initial;function xe(f){let _=[];return f.forEach(p=>{let v={id:p.id(),type:p.is_file()?"file":"folder",icon:p.is_file()?D.Document:D.Folder,name:p.is_file()?Ue(p.name()).name:p.name(),displayName:p.is_file()?Ue(p.name()).name:p.name(),size:p.size(),remotePath:p.path(),imageThumbnail:p.is_file()&&p.thumbnail().length>0?Ir(p.thumbnail()):void 0,isRenaming:x.Initial,extension:p.is_file()?Ue(p.name()).extension:"",source:"",items:p.is_file()?void 0:xe(p.directory().get_items())};_=[..._,v]}),_.sort((p,v)=>p.type===v.type?p.name.localeCompare(v.name):v.type.localeCompare(p.type)),_}async function Wt(f){return await Promise.all(f.map(async p=>{var T,L;const v=be.getChat(p.name);if(v&&v.name===""){const M=await Nn.identity_from_did(v.users[1]);p.displayName=(T=M==null?void 0:M.name)!=null?T:"",p.chat=v}else v&&(p.displayName=(L=v==null?void 0:v.name)!=null?L:p.name,p.chat=v);return p}))}async function W(){(await O.getCurrentDirectoryFiles()).onSuccess(async _=>{let p=await Wt(xe(_)),v=new Set(p);B.updateFileOrder(Array.from(v)),he(s,d=Array.from(v),d)}),(await O.canGoBack()).fold(_=>{},_=>_e.set(_))}function Yt(f){f.items&&f.items.length>0&&B.updateFileOrder(f.items)}yn(async()=>{await O.checkLoaded(),await O.getStorageFreeSpaceSize(),await W();let f=0,_=null;document.querySelector(".files").addEventListener("mousedown",L=>{let M=L.target;for(;M&&!M.classList.contains("draggable-item");)M=M.parentElement;const Q=Date.now();if(_===M&&Q-f<200&&_.classList.contains("folder-draggable")){const Z=M.dataset.id;if(d.find(ne=>ne.id===Z),M){const ne=M.dataset.id,se=d.find(ae=>ae.id===ne);se&&(Yt(se),Ut(se))}}_=M,f=Q});let v=null,T=null;document.addEventListener("dragstart",L=>{v=L.target.closest(".draggable-item")}),document.addEventListener("dragover",L=>{L.preventDefault()}),document.addEventListener("drop",L=>{L.preventDefault();const M=L.target.closest(".draggable-item");if(M&&v){T=M.getAttribute("data-id");const Q=v.getAttribute("data-id"),Z=d.find(ne=>ne.id===Q);v&&(v.getAttribute("data-id"),T&&Z&&T!==Z.id&&(Z.parentId=T,Gt(Z,T))),v=null}})});function et(f){var _;f.preventDefault(),we++,ke=((_=f.dataTransfer)==null?void 0:_.items.length)||0}function Ht(f){f.preventDefault(),we--,we===0&&setTimeout(()=>{},300)}async function tt(f){var v;if(f.preventDefault(),f.target.closest(".draggable-item"))return;we=0;let p=(v=f.dataTransfer)==null?void 0:v.files;if(ke=0,p){ke=p.length;for(let T=0;T<ke;T++){let L=p[T];const M=L.stream(),Q=L.name.split("."),Z=Q.slice(0,-1).join("."),ne=Q.slice(-1)[0];let se=L.name,ae=1;d.forEach(lt=>{`${lt.name}.${lt.extension}`===se&&(se=`${Z} (${ae}).${ne}`,ae++)}),await qt(se,M,L.size)}}W(),setTimeout(()=>{},300)}async function qt(f,_,p){(await O.uploadFilesFromStream(f,_,p)).onFailure(T=>{B.addToastNotification(new ee("",T,3,D.XMark,R.Error))})}function Jt(){zn(Tt.Chat),pe.select_first()}const nt=async f=>{const _=f.target;if(_&&_.files)for(let p=0;p<_.files.length;p++){const v=_.files[p],T=v.stream(),L=v.name.split("."),M=L.slice(0,-1).join("."),Q=L.slice(-1)[0];let Z=v.name,ne=1;d.forEach(ae=>{`${ae.name}.${ae.extension}`===Z&&(Z=`${M} (${ne}).${Q}`,ne++)}),(await O.uploadFilesFromStream(Z,T,v.size)).onFailure(ae=>{B.addToastNotification(new ee("",ae,3,D.XMark,R.Error))})}_.value="",W()};async function Me(f){(await O.deleteItem(f)).fold(p=>{B.addToastNotification(new ee("",p,2))},p=>{W(),B.addToastNotification(new ee("",`Successfully deleted item "${f}"`,2))})}async function ze(f,_,p=""){_=_.trim();let v=f.name;return f.type==="folder"&&v.trim()===""&&_===""||v.trim()===_?!1:_===""?(B.addToastNotification(new ee("","Empty name provided",2)),!1):((await O.renameItem(p===""?`${v}`:`${v}.${p}`,p===""?`${_}`:`${_}.${p}`)).fold(L=>{if(f.isRenaming=x.Error,L===st.ITEM_ALREADY_EXIST_WITH_SAME_NAME){W(),B.addToastNotification(new ee("","Other item already exists with this name",2));return}W(),B.addToastNotification(new ee("",L,2))},L=>{f.isRenaming=x.Success,B.addToastNotification(new ee("",`Successfully renamed "${v}" to "${_}"`,2)),W()}),!0)}async function rt(f){(await O.downloadFile(f)).fold(p=>{B.addToastNotification(new ee("",p,2))},p=>{const v=URL.createObjectURL(p),T=document.createElement("a");T.href=v,T.download=nr.basename(f),document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(v)})}function Kt(f){An.call(this,l,f)}const Qt=f=>{t(4,Fe=null)},Zt=f=>{t(4,Fe=null)};function xt(f){Ie[f?"unshift":"push"](()=>{pe=f,t(6,pe)})}function en(f){$e=f,t(5,$e)}const tn=f=>{t(3,Ne="chats")},nn=f=>{t(3,Ne="files")},rn=(f,_)=>{const p=new Date(f.last_message_at||0);return new Date(_.last_message_at||0).getTime()-p.getTime()},ln=f=>be.removeSidebarChat(f);function an(f){$e=f,t(5,$e)}const sn=()=>pe.filter_chat(),on=async()=>{ce==null||ce.click()},fn=f=>nt(f);function un(f){Ie[f?"unshift":"push"](()=>{ce=f,t(7,ce)})}const cn=async(f,_,p)=>(t(8,Se=void 0),p?!1:ze(f,`${_}`,`${f.extension}`)),mn=(f,_)=>{t(2,ge=!0),f(_)},dn=async f=>{he(s,d=d.map(_=>(_.id===f.id?_.isRenaming=x.Loading:_.isRenaming=x.Initial,_)),d)},gn=async f=>{rt(`/${f.name}.${f.extension}`)},$n=f=>{Me(`/${f.name}.${f.extension}`)},pn=f=>{t(2,ge=!1)},_n=async(f,_,p,v,T)=>{if(T)return W(),!1;if(t(8,Se=void 0),f.name.trim()===""){const L=`${v}`;return he(s,_[p].name=L,d),await Ze(f),!0}else return ze(f,`${v}`)},hn=(f,_)=>{t(2,ge=!0),f(_)},bn=f=>{Me(`/${f.name}/`)},vn=async f=>{he(s,d=d.map(_=>(_.id===f.id?_.isRenaming=x.Loading:_.isRenaming=x.Initial,_)),d)},kn=f=>{t(2,ge=!1)},wn=(f,_)=>{t(4,Fe=f.source)},Fn=f=>{et(f)},Cn=f=>{tt(f)};return l.$$set=f=>{"browseFilesForChatMode"in f&&t(0,Qe=f.browseFilesForChatMode)},l.$$.update=()=>{l.$$.dirty[0]&2&&Bt(t(14,r=B.getUsersLookup(C.users)))},Nt(t(15,n=be.state.sidebarOpen)),Te(t(13,a=B.state.openFolders)),g(t(12,s=B.state.files)),zt(t(11,i=O.freeStorageSpace)),Mt(t(10,o=be.state.chats)),G(t(9,c=B.state.activeChat)),[Qe,C,ge,Ne,Fe,$e,pe,ce,Se,c,o,i,s,a,r,n,d,h,P,z,He,qe,Je,Ke,Ot,Vt,Ce,_e,jt,Ze,Xt,W,et,Ht,tt,Jt,nt,Me,ze,rt,Kt,Qt,Zt,xt,en,tn,nn,rn,ln,an,sn,on,fn,un,cn,mn,dn,gn,$n,pn,_n,hn,bn,vn,kn,wn,Fn,Cn]}class Hr extends Xe{constructor(e){super(),Ge(this,e,yr,Sr,ye,{browseFilesForChatMode:0},null,[-1,-1,-1])}}export{Hr as component};
